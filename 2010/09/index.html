<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Meta Robots Tag -->
  <meta name="robots" content="all">

  <!-- Site Author -->
  <meta name="author" content="bo">

  <!-- Atom Feed -->
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Bo Jeanes Feed">
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="/assets/css/minimal.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png">

  <!-- Analytics -->
  

  <!-- SEO -->
  <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Bo Jeanes</title>
<meta property="og:title" content="Bo Jeanes" />
<meta name="author" content="Bo Jeanes" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://bjeanes.com/2010/09/" />
<meta property="og:url" content="https://bjeanes.com/2010/09/" />
<meta property="og:site_name" content="Bo Jeanes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2010-09-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@bjeanes" />
<meta name="twitter:creator" content="@bjeanes" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://bjeanes.com/2010/09/"},"description":null,"@type":"BlogPosting","url":"https://bjeanes.com/2010/09/","name":null,"headline":"Bo Jeanes","dateModified":"2010-09-01T00:00:00+00:00","datePublished":"2010-09-01T00:00:00+00:00","sameAs":null,"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://avatars2.githubusercontent.com/u/2560?s=200&v=4"},"name":"Bo Jeanes"},"image":null,"author":{"@type":"Person","name":"Bo Jeanes"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body class="black-90 ">

<div class="flex flex-column items-center">
  <div class="mw7 w-100 ph3 ph4-ns">
    <h1 class="f5 fw4 lh-title mb0 pb2 bb b--light-gray">Posts from September 2010</h1>

    
    <a class="link black-80 hover-silver" href="/2010/09/pausing-cucumber-scenarios-to-debug/">
      <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
        <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2010</time></div>
        <h3 class="f3 fw6 lh-title mb0">Pausing Cucumber Scenarios to Debug</h3>
        <p class="f5 fw3 lh-copy mv2">Continuing what I started with my <a href="http://bjeanes.com/2010/09/19/selector-free-cucumber-scenarios">post last
light</a>,
I’ve got another tip for developing productively when using Cucumber.

I’m going to show you a simple way to pause cucumber stories in order to
investigate the current state of your application at that point.

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">AfterStep</span><span class="p">(</span><span class="s1">'@pause'</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">print</span> <span class="s2">"Press Return to continue"</span>
  <span class="no">STDIN</span><span class="p">.</span><span class="nf">getc</span>
<span class="k">end</span>
</code></pre></div></div>

Then just tag any Cucumber feature or scenario with <code class="highlighter-rouge">@pause</code>. After the
first step is run, the scenario will stop running and you can do
whatever you like before proceeding.

My favourite tactic is to combine the <code class="highlighter-rouge">@pause</code> tag with <code class="highlighter-rouge">@selenium</code> tag
to have WebDriver stop driving FireFox for a moment and let me click
around in the application or inspect the HTML/CSS at that point.

My next post will be about enabling FireBug in the “WebDriver” profile
to help inspecting the web page when you’ve paused a scenario.
</p>
  
        <div class="f6 fw3 silver mt0">
          
          <time>20 Sep 2010</time>
          
          <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
        </div>
      </article>
    </a>
    
    <a class="link black-80 hover-silver" href="/2010/09/selector-free-cucumber-scenarios/">
      <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
        <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2010</time></div>
        <h3 class="f3 fw6 lh-title mb0">Selector-Free Cucumber Scenarios</h3>
        <p class="f5 fw3 lh-copy mv2"><small>(a Serbo-Croation translation by Anja Skrbaa is available <a href="http://science.webhostinggeeks.com/selektor-free">here</a>)</small>

I’ve been using Cucumber since pretty much the first day I heard about
it. I’ve worked on a lot of projects that have relied on it’s presence
for reliable development. Therefore, I’ve put a lot of effort into
perfecting my Cucumber infrastructure to make this fantastic tool even
better. I’m going to share one such morsel of code that makes developing
with Cucumber even greater.

<h2 id="the-problem">The Problem</h2>

I’ve worked on a lot of web applications and, as I’m sure many of you
know, quite often the development of a web application is focussed on
the functionality foremost, and the interface and style is incorporated
later. It may be that the client doesn’t yet know the feel they want for
their project or that they want to focus their budget towards
prototyping the application first.

This is fine, except for the fact that changing the HTML and CSS of a
web application after a lot of functionality has been developed is a
fantastic way to break all your integration tests.

This is particularly true if you have scenarios like the following
contrived one:

<div class="language-cucumber highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">When </span>I fill in <span class="s">"Username"</span> with <span class="s">"bjeanes"</span> within <span class="s">".main-panel form#signup-form"</span>
<span class="nf">And </span>I press <span class="s">"Sign up!"</span> within <span class="s">".main-panel form#signup-form"</span>
<span class="nf">Then </span>I should see <span class="s">"You have successfully signed up"</span> within <span class="s">".flash.notice"</span>
</code></pre></div></div>

The problem is, of course, that designers might change the HTML that
used to be <code class="highlighter-rouge">.main-panel form#signup-form</code> into something sexier and more
semantic.

<h2 id="the-solution">The Solution</h2>

This problem is not unlike an already-solved one; we’ve all moved away
from hardcoding URLs like “/users/new” into our views and Cucumber
scenarios and replacing them with <code class="highlighter-rouge">new_user_path</code> and <code class="highlighter-rouge">the signup page</code>,
respectively.

So why not apply the same formula that <code class="highlighter-rouge">paths.rb</code> uses for removing URLs
from scenarios to our situation with selectors?

Here’s what I add to all new projects:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># I'm in features/step_definitions/web_ext_steps.rb</span>

<span class="no">When</span> <span class="sr">/^(.*) within ([^:"]+)$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">step</span><span class="p">,</span> <span class="n">scope</span><span class="o">|</span>
  <span class="n">with_scope</span><span class="p">(</span><span class="n">selector_for</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span> <span class="k">do</span>
    <span class="no">When</span> <span class="n">step</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Multi-line version of above</span>
<span class="no">When</span> <span class="sr">/^(.*) within ([^:"]+):$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">step</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">table_or_string</span><span class="o">|</span>
  <span class="n">with_scope</span><span class="p">(</span><span class="n">selector_for</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span> <span class="k">do</span>
    <span class="no">When</span> <span class="s2">"</span><span class="si">#{</span><span class="n">step</span><span class="si">}</span><span class="s2">:"</span><span class="p">,</span> <span class="n">table_or_string</span>
  <span class="k">end</span>
<span class="k">end</span>  
</code></pre></div></div>

And:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># I'm in features/support/selectors.rb</span>

<span class="k">module</span> <span class="nn">HtmlSelectorsHelper</span>
  <span class="k">def</span> <span class="nf">selector_for</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">scope</span>
    <span class="k">when</span> <span class="sr">/the body/</span>
      <span class="s2">"html &gt; body"</span>
    <span class="k">else</span>
      <span class="k">raise</span> <span class="s2">"Can't find mapping from </span><span class="se">\"</span><span class="si">#{</span><span class="n">scope</span><span class="si">}</span><span class="se">\"</span><span class="s2"> to a selector.</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span>
        <span class="s2">"Now, go and add a mapping in </span><span class="si">#{</span><span class="kp">__FILE__</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">World</span><span class="p">(</span><span class="no">HtmlSelectorsHelper</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="applying-the-solution">Applying the Solution</h2>

My previous example of the flawed Cucumber scenario now becomes:

<div class="language-cucumber highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">When </span>I fill in <span class="s">"Username"</span> with <span class="s">"bjeanes"</span> within the sign up form
<span class="nf">And </span>I press <span class="s">"Sign up!"</span> within the sign up form
<span class="nf">Then </span>I should see <span class="s">"You have successfully signed up"</span> within the notice flash
</code></pre></div></div>

And the <code class="highlighter-rouge">selectors.rb</code> case statement gets the following additions:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span>
  <span class="c1"># ...</span>
  
  <span class="k">when</span> <span class="sr">/the sign up form/</span>
    <span class="s2">".main-panel form#signup-form"</span>
  <span class="k">when</span> <span class="sr">/the (notice|error|info) flash/</span>
    <span class="s2">".flash.</span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="s2">"</span>
  
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

Notice how the scenario now identifies things on our page by their
semantic identifiers, not by brittle CSS or XPath locations which are
prone to change. As a bonus, now <del>if</del> when they do change, the paths only need to be updated in a single
location in our Cucumber test suite!

<h2 id="patching-cucumber">Patching Cucumber</h2>

I feel pretty strongly that CSS and XPath don’t belong in our feature
files because not only does it encourage brittle tests (as shown above),
but also because those selectors are entirely irrelevant to end users,
and that’s kind of the main point of using a natural language DSL to
describe our integration tests, i.e. putting on the user shoes.

<del>
I’d really like to patch this back into Cucumber, and I entirely plan to
do so, providing I get the time.</del>

&lt;/del&gt;
I got the time, and here is my <a href="http://github.com/aslakhellesoy/cucumber-rails/pull/63">pull
request</a> to have
it merged.

<h2 id="expanding-the-solution">Expanding the Solution</h2>

You’ll note my <code class="highlighter-rouge">HtmlSelectorsHelper</code> module only accommodates CSS
selectors. That’s only because I have never needed XPath in this
context. It’d be very simple to modify my examples to do so, though,
with a combination of multiple return values and a splat. That’s an
exercise for the reader (or me if I end up patching Cucumber).

<h2 id="final-word">Final Word</h2>

I apologise for the length of this article, but I congratulate you for
making it all the way through it!

I now have so many blog post ideas lined up that I’ve had to create a
new category in Things.app just to hold them all. This means that I’ll
be striving to get a few more posts done and out the door in the next
few weeks, including a performance comparison of different data
encapsulations for web application APIs on the iPhone (i.e. is it better
to use Plists, JSON, or XML?) and a post on why I think there should be
8 RESTful actions, not the 7 that Rails prescribes by default.
</p>
  
        <div class="f6 fw3 silver mt0">
          
          <time>19 Sep 2010</time>
          
          <span class="ttl">&middot; 



  
	  3 min read
	

</span>
        </div>
      </article>
    </a>
    

  </div>
</div>

<footer class="flex justify-start items-baseline mw7 center w-100 ph3 ph4-ns mt4 mb2 lh-copy">
  <nav class="flex flex-row flex-wrap">
    <span class="f7 fw3 silver mr3 ttc"><a href="https://bjeanes.com/" class="f7 fw5 silver hover-silver link underline-hover" title="Bo Jeanes">Bo jeanes</a> &copy; 2020</span>
    

    
    <span class="f7 fw3 silver mr3">Designed with <a href="https://desiredpersona.com/themes/" class="f7 fw3 silver hover-silver link underline-hover mr3" target="_blank">Minimal Theme</a></span>
    
  </nav>
</footer>

</body>
</html>
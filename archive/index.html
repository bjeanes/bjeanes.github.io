<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Meta Robots Tag -->
  <meta name="robots" content="all">

  <!-- Site Author -->
  <meta name="author" content="bo">

  <!-- Atom Feed -->
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Bo Jeanes Feed">
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="/assets/css/minimal.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png">

  <!-- Analytics -->
  

  <!-- SEO -->
  <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Archive | Bo Jeanes</title>
<meta property="og:title" content="Archive" />
<meta name="author" content="Bo Jeanes" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Archive" />
<meta property="og:description" content="Archive" />
<link rel="canonical" href="https://bjeanes.com/archive/" />
<meta property="og:url" content="https://bjeanes.com/archive/" />
<meta property="og:site_name" content="Bo Jeanes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@bjeanes" />
<meta name="twitter:creator" content="@bjeanes" />
<script type="application/ld+json">
{"mainEntityOfPage":null,"description":"Archive","@type":"WebPage","url":"https://bjeanes.com/archive/","name":null,"headline":"Archive","dateModified":null,"datePublished":null,"sameAs":null,"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://avatars2.githubusercontent.com/u/2560?s=200&v=4"},"name":"Bo Jeanes"},"image":null,"author":{"@type":"Person","name":"Bo Jeanes"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body class="black-80 ">



<section class="flex flex-column mw7 center ph3 ph4-ns f5 f4-ns fw3 lh-copy mb0">
  <h1 class="f5 fw4 lh-title mb0 pb2 bb b--light-gray">All Posts</h1>

  
  <a class="link black-80 hover-silver" href="/2017/12/deploy-directory-to-branch/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Dec 2017</time></div>
      <h3 class="f3 fw6 lh-title mb0">Deploy a sub-directory as a branch</h3>
      <p class="f5 fw3 lh-copy mv2">This post outlines a mechanism for using one branch as the source to generate a
compiled artifact into another branch. This is achieved without resorting to
moving files around a working directory and staging dirty changes away safely,
by leveraging some neat internals of Git.

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>11 Dec 2017</time>
        
        <span class="ttl">&middot; 



  
	  4 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2017/12/automatically-refresh-staging-db/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Dec 2017</time></div>
      <h3 class="f3 fw6 lh-title mb0">Automatically refresh staging databases weekly from production snapshot</h3>
      <p class="f5 fw3 lh-copy mv2">To get the most out of staging environments, it is important to have production
quality data (in both variety and size) at your disposal to identify potential
production problems before your customers do. For example, good data allows
developers to check that new features behave as expected with real-world data,
that a bugfix actually fixes a bug for a known scenario, or to benchmark a
database migration or the performance of new code.

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>11 Dec 2017</time>
        
        <span class="ttl">&middot; 



  
	  5 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2013/07/makers-and-making/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2013</time></div>
      <h3 class="f3 fw6 lh-title mb0">Makers &amp; Making</h3>
      <p class="f5 fw3 lh-copy mv2"><small><em><strong>TL;DR</strong> I have moved to another city to start a new job because I believe that the best way that I can make the world a better place is by making great tools to help other creative people do their best work possible.</em></small>

Turning thought into reality quickly is what drew me to programming when I was young. There is such a raw and incomparable power that you get when making things with code and with perfectly suited software tools.

<h2 id="makers">Makers</h2>

A master cabinet maker can build the most ornate and beautiful cabinet with the simplest tools but it takes a long time and mistakes are costly. When mistakes are costly and the creative process is extensive, the cabinet maker’s ability to experiment and grow is hindered, and the quality can suffer as a result. With better tools, (s)he can be more productive, experiment with new designs through prototyping, and improve their craft.

<h2 id="making-for-makers">Making for Makers</h2>

I am a tool maker.

I’ve known this for some time now. My deepest satisfaction in my work has come from making someone else’s job easier, more productive, and, most importantly, more enjoyable.

The master cabinet maker is arguably adding value to the world, no matter their productivity. However, as a tool maker, one has the ability to have a multiplicative effect on the world. By making tools for other makers the effect is arguably exponential.

I want to help all makers experiment, grow, and, ultimately, make the world better.

Building great tools is quickly becoming my <a href="https://vimeo.com/36579366">guiding principle</a>. I plan to do this by remembering that <a href="http://www.pechakucha.org/channels/table-xi/presentations/the-most-valuable-skill">feedback is the most valuable skill</a> to learning, growing, and making and incorporating this concept into the tools that I build. Great tools provide actionable and specific feedback quickly and directly.

<h2 id="heroku-makes-for-makers">Heroku Makes for Makers</h2>

Next Monday will be my first day at <a href="https://www.heroku.com">Heroku</a>. I’ve used Heroku in some form or another since it was <a href="https://blog.heroku.com/archives/2009/1/12/whats_up_at_heroku">an online code editor for Rails</a>.

The moment I knew I was going to join Heroku was when I was allowed to sit in on one of their all hands, where I heard <a href="https://twitter.com/teich">Oren Teich</a> talk about Heroku’s guiding principle. More or less, he articulated my own guiding principle of helping makers.

I couldn’t be more excited to start.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>19 Jul 2013</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2013/05/two-months-without-twitter/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>May 2013</time></div>
      <h3 class="f3 fw6 lh-title mb0">Two months without Twitter</h3>
      <p class="f5 fw3 lh-copy mv2">Two months ago, frustrated with inability to focus on the things I cared about in life and at work, I formed a theory:

<blockquote>
  Twitter (et al.) has slowly been rewiring my brain to encourage rapid context switching.
</blockquote>

On average, it probably takes less than a second to read and process a tweet. There are often hundreds of new tweets between “hits,” which means that during vulnerable times of the day (e.g. in bed before sleep), <strong>my brain is rapidly context switching hundreds of times in a matter of minutes</strong>.

For me, Twitter has always been about consuming information and learning. Despite the fear of “missing out” on interesting links or thoughts in my network[1], which is predominantly made of people I respect and trust, <strong>I decided that this rapid and varied consumption is not a healthy way to achieve this goal</strong>.

It’s been two months since I uninstalled all Twitter (and Facebook) applications from all my devices. I still tweet occasionally (using iOS/Mac’s Notification Center), but I make a point not to check the Twitter feed. <strong>I re-enabled email notifications</strong> for mentions and only log in to the web interface to reply to mentions/messages.

I love it. I want this to stick.

<small>[1] <a href="http://getprismatic.com">Prismatic</a> is a pretty great way of countering this. It usually cuts through the noise and gives me meal-sized versions of the best content, instead of bite-sized versions of irrelevancy.</small>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>10 May 2013</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2013/03/a-collaborative-thought-experiment-on-company-environment-values-culture-and-ethos/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Mar 2013</time></div>
      <h3 class="f3 fw6 lh-title mb0">A collaborative thought experiment on company environment, values, culture, and ethos</h3>
      <p class="f5 fw3 lh-copy mv2"><strong>TL;DR</strong>: add your thoughts/experience on company values and culture to <a href="https://github.com/bjeanes/culture">this repo</a>.

Lately, I have been thinking a lot about the types of working environments and how they impact the productivity and happiness of the people who work in them.

After many discussions on and research into the topics of leadership, management, and company culture, I felt like I had to start taking notes of how everything pieced together. Specifically, I wanted to write down what the culture and environment look like of a company that I would love to work at and/or start.

Being a developer and contributor to open source software, it seemed clear to me that something like this could benefit immensely from a collaborative and open approach.

And so, <a href="https://github.com/bjeanes/culture">here</a> is the ever-evolving work and distillation of this process.

I’d love for people to contribute their input in the form of pull requests and discussions. And, where more appropriate, people or companies could fork the still-not-aptly-titled work to form the basis of a different set of values.

If I were to start a company right now, a living document like this would be available for all employees to see, discuss, dispute, and change.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>5 Mar 2013</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2013/02/critiquing-leadership-part-1-of-n-on-leadership/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Feb 2013</time></div>
      <h3 class="f3 fw6 lh-title mb0">Critiquing Leadership (Part 1 of N on Leadership)</h3>
      <p class="f5 fw3 lh-copy mv2"><small>This is part 1 of some unknown number of thoughts and essays on leadership. Your thoughts are welcomed in the comments.</small>

If leaders (or managers, as it were) are not constantly soliciting critique from their followers, their harshest critics won’t feel safe being honest or speaking up at all.

This can create a bubble of false perception, by such leaders, that they are doing well. Instead of hearing the honest criticism (which, of course, still exists), it will spread laterally behind closed doors and manifest in alienation, resentment, and/or apathy.

This can only perpetuate the problem.

If you are a leader and you are not being openly critized by those you purport to lead, that is a warning sign. Note that, like all humans everywhere, you are not perfect; a lack of criticism is therefore a sign of something other than your successes. Likely, it’s a sign that you do not have a healthy relationship with your followers (or employees).

Do not wait for criticism — seek it out. Do not form a bubble of complacency that limits your perception of reality and your ability to handle the inevitable, your loss of followers (or employees).
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>25 Feb 2013</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2012/11/talk-ssh-can-do-that/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Nov 2012</time></div>
      <h3 class="f3 fw6 lh-title mb0">Talk: SSH Can Do That?</h3>
      <p class="f5 fw3 lh-copy mv2">Last night I gave a talk on the darker side of SSH at <a href="www.meetup.com/ChicagoSC/">ChiSC meetup group</a>.

Here’s a video version (better quality one coming soon) for those who are interested:

<iframe src="http://player.vimeo.com/video/54505525?byline=0&amp;portrait=0&amp;badge=0&amp;color=cc7833" width="500" height="281" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>29 Nov 2012</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2012/09/call-clojure-function-on-a-timer/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2012</time></div>
      <h3 class="f3 fw6 lh-title mb0">Call Clojure function on a timer</h3>
      <p class="f5 fw3 lh-copy mv2">In Clojure, I didn’t see a nice way to simply call a function on a timer (e.g. to poll for changes in another service).

I didn’t find something in <code class="highlighter-rouge">clojure.core</code> to achieve this readily (but <code class="highlighter-rouge">clojure.core</code> is quite big, so I may have missed something obvious — let me know), so I whipped up the following to put in my project’s <code class="highlighter-rouge">util.clj</code> file:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">tick</span><span class="w">
  </span><span class="s">"Call f with args every ms. First call will be after ms"</span><span class="w">
  </span><span class="p">[</span><span class="n">ms</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w">

  </span><span class="p">(</span><span class="nf">future</span><span class="w">
    </span><span class="p">(</span><span class="nb">doseq</span><span class="w"> </span><span class="p">[</span><span class="n">f</span><span class="w"> </span><span class="p">(</span><span class="nf">repeatedly</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">args</span><span class="p">))]</span><span class="w">
      </span><span class="p">(</span><span class="nf">Thread/sleep</span><span class="w"> </span><span class="n">ms</span><span class="p">)</span><span class="w">
      </span><span class="p">(</span><span class="nf">f</span><span class="p">))))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">tick-now</span><span class="w">
  </span><span class="s">"Call f with args every ms. First call will be immediately (and blocking)"</span><span class="w">
  </span><span class="p">[</span><span class="n">ms</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">]</span><span class="w">

  </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w">
  </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">tick</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

There are two variants. <code class="highlighter-rouge">tick</code> waits <code class="highlighter-rouge">ms</code> milliseconds and then calls <code class="highlighter-rouge">f</code> with <code class="highlighter-rouge">args</code> and repeats indefinitely. <code class="highlighter-rouge">tick-now</code> does the same thing except it calls <code class="highlighter-rouge">f</code> with <code class="highlighter-rouge">args</code> <em>before</em> starting the timer.

They are simple to use:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">tick</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">println</span><span class="w"> </span><span class="s">"hi"</span><span class="p">))</span><span class="w">
</span><span class="c1">; 500ms delay</span><span class="w">
</span><span class="n">hi</span><span class="w">
</span><span class="c1">; 500ms delay</span><span class="w">
</span><span class="n">hi</span><span class="w">
</span><span class="c1">; 500ms delay</span><span class="w">
</span><span class="n">hi</span><span class="w">
</span><span class="n">...</span><span class="w">
</span></code></pre></div></div>

In my project, I’m using them like so:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">start-fetchers</span><span class="w">
  </span><span class="p">[</span><span class="n">api-token</span><span class="p">]</span><span class="w">

  </span><span class="p">(</span><span class="nf">future</span><span class="w">
    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">minutes</span><span class="w"> </span><span class="p">(</span><span class="nb">partial</span><span class="w"> </span><span class="nb">*</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">1000</span><span class="p">)]</span><span class="w">
      </span><span class="p">(</span><span class="nf">tick-now</span><span class="w"> </span><span class="p">(</span><span class="nf">minutes</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span><span class="w">
                </span><span class="n">update-project-list!</span><span class="w">
                </span><span class="n">api-token</span><span class="p">)</span><span class="w">

      </span><span class="p">(</span><span class="nf">tick-now</span><span class="w"> </span><span class="p">(</span><span class="nf">minutes</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">
                </span><span class="n">fetch-milestones!</span><span class="w">
                </span><span class="n">api-token</span><span class="w">
                </span><span class="n">projects-to-fetch</span><span class="w">
                </span><span class="n">milestones-by-project</span><span class="p">))))</span><span class="w">
</span></code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>20 Sep 2012</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2012/09/pure-evil/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2012</time></div>
      <h3 class="f3 fw6 lh-title mb0">Pure Evil</h3>
      <p class="f5 fw3 lh-copy mv2">I love Vim. I take that back — I love <strong>modal editing</strong>.

Actually, I think very few people like <em>Vim</em>, it just happens to be the best kid on the block at modal editing. But, after using Vim (and, God, does it take a while to learn to <em>use</em> it), you are reduced to a <q><a href="http://haldean.org/docstore/?vim-problems">pathetic teary wreck every time [you] have to use a text editor that isn’t vim</a></q>.

And why <em>is</em> it so debilitating to use something other than Vim for those who have honed their modal editing skills? Frankly, magic sauce of Vim is (mostly) made up from a few quite simple ingredients: motions, text objects, operators. There are plenty of cool tricks hidden inside Vim, but those three main things are the things you really miss, consistently, when using something else.

Every now and then, when forced outside of the comforting (yet somehow cold) embrace of Vim, the Vimmer flirts with Sublime Text 2’s <a href="http://www.sublimetext.com/docs/2/vintage.html">vintage mode</a> or <a href="http://plugins.intellij.net/plugin/?id=164">IdeaVIM</a>. We may even be impressed — but, eventually, something falls apart and the abstraction leaks.

Usually, this failure happens because the Vi(m) emulation layer often doesn’t implement motions, text objects, and operators. They just implement some keystrokes that appear to do the same thing in the same way — until you try something the developer didn’t preempt.

If I could have an editor that did these things <em>properly</em>, I would have no real attachment to Vim. I have other things about Vim that I love and would hate to lose but they aren’t unique and other editors (can) have them, too.

Luckily for me, I’ve been doing too much Clojure to ignore Emacs forever and 2 weeks ago, I switched. Here’s how it played out:

<blockquote>
  Nope — not for me… But, wait! Let us try this <a href="http://emacswiki.org/emacs/Evil">Evil Mode</a> so we can mock their pitiful attempt at modal editing (*evil laugh here*).  What’s this‽ It’s actually good!
</blockquote>

Inner dialogs aside, I’m not kidding; Evil Mode is stunning. It doesn’t have <em>everything</em> — but everything that it does have is built up using the same <strike>functions</strike> macros that you can use to extend it. Those are: <code class="highlighter-rouge">(evil-define-state)</code> (“mode” is an existing term in Emacs so what Vim calls modes, Evil Mode calls “states”), <code class="highlighter-rouge">(evil-define-motion)</code>, <code class="highlighter-rouge">(evil-define-operator)</code>, <code class="highlighter-rouge">(evil-define-text-object)</code>, and a <a href="https://gitorious.org/evil/evil/blobs/raw/doc/doc/evil.pdf">few others</a>.

Evil Mode correctly implements the plumbing to wire these things together so that the Vim “language” which becomes natural and reflexive (e.g. <code class="highlighter-rouge">di”</code> -&gt; “<strong>d</strong>elete <strong>i</strong>nside double quotes”, <code class="highlighter-rouge">vt </code> -&gt; “<strong>v</strong>isually select <strong>t</strong>ill space`) is completely preserved. If you wanted to define a new text object (e.g. a Ruby block), it is trivial to do so and all of the motions and operators will work flawlessly with it immediately. Frankly, it’s not even that nice in Vim.

At the end of the day, I’ve always hated things like VimScript and Vim’s single-threadedness but I could never walk away from a truly powerful (and mostly extensible) modal editing system. Now, that has changed; I get ELisp (which, for all its faults, is exponentially better than VimScript), a saner package system, and a level of extensibility that, by design, can never be matched by Vim. All that and I don’t have to give up modal editing? Hell yes!

Bonus points: one of the “states” that Evil implements is an Emacs state; this leaves Emacs and all it’s default behavior and keymappings 100% intact, meaning you can pair fearlessly with Emacsen, or slowly learn more about the Emacs way of doing things, if desirable.

So far, I’ve rarely noticed I’m not in Vim and am constantly surprised when I employ Vim reflexes in Emacs and they work <em>exactly</em> as expected or better (seriously, try <code class="highlighter-rouge">:%s/foo/bar/g</code> in Evil mode and tell me you don’t squeal with joy).

I refuse to pick a single side, so I’m picking both. I’m going to edit modally in Emacs and I’m going to be happy doing it! I don’t care if I simultaneously piss off Vim users and Emacs users — hell, they need more things in common anyway…
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>7 Sep 2012</time>
        
        <span class="ttl">&middot; 



  
	  3 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2012/09/happier-as-a-hacker/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2012</time></div>
      <h3 class="f3 fw6 lh-title mb0">Happier as a Hacker</h3>
      <p class="f5 fw3 lh-copy mv2">I’ve grown a lot in the last few years, personally and, specifically, in my career. My values have changed and it’s affected the way I think and work.

There has been a gradual progression towards caring more and more about the Right Way™ to do things. For example, more than ever before, I value simplicity and clarity over ease and cleverness (an epidemic that greatly afflicts the Ruby community, in my opinion).

But, these values have come at a cost to me. Somewhere along the way, I complacently let <em>getting it right</em> become far more important than <em>getting it done</em>.” Don’t get me wrong, getting things right is very important — where I went wrong was valuing getting it right the <strong>first</strong> time.

It may not plague others to the extent that it has me, but this misplaced obsession has gotten in the way of progress. It’s caused a type of analysis paralysis not unlike writers’ block; I discard ideas and directions too early because they aren’t “good enough.” But exploring a potentially bad direction is still being better than having no direction — which is the only place you end up when you discard ideas before they have a chance to blossom.

In the eternal words of <a href="http://en.wikipedia.org/wiki/Into_the_Woods">Little Red Ridinghood</a>:

<blockquote>
  Isn’t it nice to know a lot?<br />
And a little bit not.
</blockquote>

I was happier as a hacker, blissfully ignorant as I was, because I got things done.

It’s time to become a hacker again; it’s time to be creative and explorative, and work towards <em>approximating</em> the Right Way™, iteratively. Truly, this is one of the great realizations of Agile — focus on progress instead of planning and pre-empting every possible outcome.

I can’t forget that.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>6 Sep 2012</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2012/09/motivate-your-lazy-sequences/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2012</time></div>
      <h3 class="f3 fw6 lh-title mb0">Motivate your lazy sequences</h3>
      <p class="f5 fw3 lh-copy mv2">I <em>love</em> Clojure’s laziness.

Recently, I’ve been using <code class="highlighter-rouge">lazy-seq</code>  to consume remote collections via APIs, fetching pages of data transparently and only as needed. <a href="http://gfredericks.com/">Gary Fredericks</a>, <a href="http://mikelikesbikes.com/">Mike Busch</a>, and I applied this to a project of ours that had to crunch tens of thousands of records from Salesforce. I’m also doing something similar with a personal project that has to fetch a lot of Pivotal Tracker stories to <code class="highlighter-rouge">reduce</code> them.

In cases like these, consuming (potentially unbounded) resources in a lazy manner allows one to start processing data earlier and to make as few requests as possible to get only the data you need.

<h2 id="mostly-lazy"><em>Mostly</em> Lazy</h2>

I want to talk about a neat little thing I did in my project to get a nice little performance boost on top of this laziness, without having to think about any low-level concurrency concerns.

<h3 id="laziness">Laziness</h3>

Here’s a piece of code that provides an “infinite” lazy sequence. In this case, it is of tweets:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="o">'</span><span class="p">[</span><span class="n">clj-http.client</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">http</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">tweets-for</span><span class="w">
  </span><span class="p">([</span><span class="n">user</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">tweets-for</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">nil</span><span class="p">))</span><span class="w">
  </span><span class="p">([</span><span class="n">user</span><span class="w"> </span><span class="n">last-tweet-id</span><span class="p">]</span><span class="w">
     </span><span class="p">(</span><span class="nf">lazy-seq</span><span class="w">
      </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">url</span><span class="w"> </span><span class="s">"http://api.twitter.com/1/statuses/user_timeline.json"</span><span class="w">
            </span><span class="n">params</span><span class="w"> </span><span class="p">{</span><span class="no">:limit</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="no">:screen_name</span><span class="w"> </span><span class="n">user</span><span class="p">}</span><span class="w">
            </span><span class="n">params</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">last-tweet-id</span><span class="w"> </span><span class="p">(</span><span class="nb">assoc</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="no">:max_id</span><span class="w"> </span><span class="n">last-tweet-id</span><span class="p">)</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w">
            </span><span class="n">response</span><span class="w"> </span><span class="p">(</span><span class="nf">http/get</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">{</span><span class="no">:query-params</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="no">:json</span><span class="p">})</span><span class="w">
            </span><span class="n">tweets</span><span class="w"> </span><span class="p">(</span><span class="no">:body</span><span class="w"> </span><span class="n">response</span><span class="p">)]</span><span class="w">

        </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nf">not-empty</span><span class="w"> </span><span class="n">tweets</span><span class="p">)</span><span class="w">
          </span><span class="p">(</span><span class="nb">concat</span><span class="w"> </span><span class="n">tweets</span><span class="w">
                  </span><span class="p">(</span><span class="nf">tweets-for</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="p">(</span><span class="no">:id</span><span class="w"> </span><span class="p">(</span><span class="nb">last</span><span class="w"> </span><span class="n">tweets</span><span class="p">)))))))))</span><span class="w">
</span></code></pre></div></div>

So that’s cool. Now, note the following performance characteristics when contemplating the next section:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">my-tweets</span><span class="w"> </span><span class="p">(</span><span class="nf">tweets-for</span><span class="w"> </span><span class="s">"bjeanes"</span><span class="p">))</span><span class="w">

</span><span class="c1">;; The following returns after a delay while we fetch the first page:</span><span class="w">
</span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">my-tweets</span><span class="p">)</span><span class="w"> </span><span class="c1">;=&gt; {:text "Tweet 0" ...}</span><span class="w">

</span><span class="c1">;; This returns instantly because our `tweets-for` function fetches 10 tweets per page:</span><span class="w">
</span><span class="p">(</span><span class="nb">nth</span><span class="w"> </span><span class="n">my-tweets</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="c1">;=&gt; {:text "Tweet 9" ...}</span><span class="w">

</span><span class="c1">;; This returns after a delay because this tweet is on the next (still lazily unfetched) page:</span><span class="w">
</span><span class="p">(</span><span class="nb">nth</span><span class="w"> </span><span class="n">my-tweets</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c1">;=&gt; {:text "Tweet 10" ...}</span><span class="w">
</span></code></pre></div></div>

<h3 id="motivation">Motivation</h3>

So laziness is pretty cool. But, sometimes, things can improve if you are ever so slightly less lazy. What if we could remove that little pause between the 9th and the 10th items in the list where we are just waiting around for the network request to Twitter to complete? We could be using our time to do more CPU-melting tweet crunching! Well, it turns out we can easily do it.

Assume for a moment that we have some calculation (<code class="highlighter-rouge">process</code>) that takes a considerable amount of CPU time to process:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">process</span><span class="w">
  </span><span class="s">"Do some really hard work with our tweets"</span><span class="w">
  </span><span class="p">[</span><span class="n">tweets</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nf">Thread/sleep</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="n">tweets</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

If we know we will be consuming a substantial amount of the lazy sequence, we could encourage the sequence to go ahead and start realizing the next chunk of our sequence.

This would mean that instead of processing 10 tweets, waiting, processing 10 tweets, waiting, etc.:

<figure class="full tc">
  <img src="https://bjeanes.com/assets/images/lazy.png" alt="Lazy sequences, visualised" />
  
    <figcaption>Lazy sequences
</figcaption>
  
</figure>

… we would be able to process tweets continuously back-to-back:

<figure class="full tc">
  <img src="https://bjeanes.com/assets/images/motivated.png" alt="Motivated sequences, visualised" />
  
    <figcaption>Motivated sequences
</figcaption>
  
</figure>

Wouldn’t also be great if we didn’t have to think about the parallelism at all? To this end, I present <code class="highlighter-rouge">motivate</code>:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">motivate</span><span class="w">
  </span><span class="s">"Motivate a lazy sequence to seek slightly ahead of the sequence consumer's position."</span><span class="w">
  </span><span class="p">([</span><span class="n">coll</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nf">motivate</span><span class="w"> </span><span class="n">coll</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w">
  </span><span class="p">([</span><span class="n">coll</span><span class="w"> </span><span class="n">motivation</span><span class="p">]</span><span class="w">
     </span><span class="p">(</span><span class="nf">lazy-seq</span><span class="w">
      </span><span class="p">(</span><span class="nf">future</span><span class="w"> </span><span class="p">(</span><span class="nb">nth</span><span class="w"> </span><span class="n">coll</span><span class="w"> </span><span class="n">motivation</span><span class="p">))</span><span class="w">
      </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="n">coll</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">motivate</span><span class="w"> </span><span class="p">(</span><span class="nb">rest</span><span class="w"> </span><span class="n">coll</span><span class="p">)</span><span class="w"> </span><span class="n">motivation</span><span class="p">)))))</span><span class="w">
</span></code></pre></div></div>

Let’s compare:

<div class="language-clojure highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">time</span><span class="w"> </span><span class="p">(</span><span class="nf">process</span><span class="w"> </span><span class="p">(</span><span class="nb">take</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">(</span><span class="nf">tweets-for</span><span class="w"> </span><span class="s">"riblah"</span><span class="p">))))</span><span class="w">
</span><span class="c1">;=&gt; “Elapsed time: 11545.011 msecs"</span><span class="w">
</span><span class="p">(</span><span class="nb">time</span><span class="w"> </span><span class="p">(</span><span class="nf">process</span><span class="w"> </span><span class="p">(</span><span class="nb">take</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">(</span><span class="nf">motivate</span><span class="w"> </span><span class="p">(</span><span class="nf">tweets-for</span><span class="w"> </span><span class="s">"riblah"</span><span class="p">)</span><span class="w"> </span><span class="mi">5</span><span class="p">))))</span><span class="w">
</span><span class="c1">;=&gt; "Elapsed time: 10394.769 msecs"</span><span class="w">
</span></code></pre></div></div>

The speed difference is noticeable even when processing only a 100 tweets. If we were doing more than 100 milliseconds/tweet of processing, fetching a lot more data, or dealing with a slow upstream dependency, the speed improvements would be even clearer.

The last (optional) parameter to <code class="highlighter-rouge">motivate</code> is the “motivation factor”. If your CPU-bound work is long-running, this number can be smaller without a noticeable difference. The ideal number depends on how long each IO operation takes and much processing you do with each chunk.

Essentially, the motivation you give to the lazy sequence is a trade-off between waiting for IO and wasting IO; that is, the lower the number, the more likely you are to wait on IO but the higher the number, the more IO you’ll perform unnecessarily (at least, if you aren’t guaranteed to consume the whole sequence.

Hopefully this is handy to someone else out there. I wouldn’t at all be surprised if something like this already existed (<strong>UPDATE</strong> Yup: <a href="http://clojuredocs.org/clojure_core/clojure.core/seque"><code class="highlighter-rouge">seque</code></a>) or if this completely obvious to seasoned Clojurian, but it was a pleasant moment discovering this possibility on my own.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>3 Sep 2012</time>
        
        <span class="ttl">&middot; 



  
	  3 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2012/02/factories-breed-complexity/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Feb 2012</time></div>
      <h3 class="f3 fw6 lh-title mb0">Factories breed complexity</h3>
      <p class="f5 fw3 lh-copy mv2">Having maintainable code is great. Maintainable code allows you to deliver improvements faster, happier, and more reliably.

Furthermore, the measures that developers need to take and the strategies that we have to employ to achieve maintainable code have been understood for years, if not decades. Especially in the realm of object-oriented programming, but certainly not exclusively, most of these principles boil down to reducing coupling and system complexity. A system whose parts are coupled as loosely as possible is a modular system; the parts know little of each other and a lot about themselves and they have thin and specific interfaces between each other.

Test-driven development is one of the many tools at a developer’s disposal to achieve code quality. Unfortunately, there is a lot of naïveté around the benefits of TDD. A lot of developers see TDD as primarily a tool for verifying system correctness. While TDD does of course offer this benefit, and arguably better than retroactive automated testing, the real benefit of TDD is that it offers short feedback loops that guide the design/architecture of the system.

Since it is accepted that a loosely-coupled modular system is a simpler system, it stands that tools, such as TDD, which guide a design towards modularity and simplicity are good tools. A module that is tightly coupled to another is not easily tested in isolation. However, if the isolated tests are written first, it is difficult to write a passing implementation for that module that maintains such a low degree of coupling. Therefore, good TDD should guide you towards a simpler design (though it is certainly not the only way).

Unfortunately, factories work against this goal. Factories debilitate TDD’s ability to give you feedback into the complexity of your design.

To be clear, I am not talking about the <a href="http://en.wikipedia.org/wiki/Factory_method_pattern">Factory Method Pattern</a>
or the <a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory Pattern</a> — both of which can be described
as ways to <q src="http://en.wikipedia.org/wiki/Object_creation#Creating_objects">decouple a particular implementation
of an object from code for the creation of such an object</q> (<cite><a href="http://en.wikipedia.org/wiki/Object_creation#Creating_objects">Wikipedia</a></cite>). Instead, I am talking about the “factories” for replacing fixtures in tests — something which has seemingly obsessed the Ruby (Rails, especially) community. The two primary Ruby libraries for factory-based fixture replacement are <a href="https://github.com/thoughtbot/factory_girl">factory_girl</a> and <a href="https://github.com/notahat/machinist">Machinist</a>.

A tool such as Machinist or factory_girl <q>generates data for the attributes you don’t care about, and constructs any necessary associated objects, leaving you to specify only the fields you care about in your test</q> (from Machinist’s own <a href="https://github.com/notahat/machinist/blob/master/README.markdown">README file</a>). This sounds nice at first, because it makes your tests more readable and relevant. However, behind the scenes, these tools are still creating other objects and entities and introducing them into your test environment. By having data and objects in tests that are irrelevant to the functionality that is being tested (in <em>isolation</em>, remember), a developer creates an environment that permits, if not invites, silent dependencies to creep into an implementation.

Furthermore, and perhaps more significantly, by creating objects (and usually entire <em>hierarchies</em> of objects) with such ease and opacity, you are outright masking the dependencies (*cough* complexity *cough* coupling) between your implementation and those entities. If forced to stub out all those intricacies, the system complexity would be screamingly obvious and a developer would quickly avail herself of a rewrite to reduce complexity or thin out the interface.

Instead of having feedback that guides a developer to simplicity, fixture factories seem to guide developers to complexity by masking dependencies as one-line simplicity. In fact, that one (or five, whatever) line setup is a shotgun blast of environmental dependencies that are hidden from the architect. That complexity will come back for revenge after being ignored for so long.

It seems that factory_girl and Machinist exist to make testing components more convenient. This is, at face value, an admirable and desirable goal. However, in unit tests, the cost is too high for any system of considerable size.

Please, do the right thing and avoid the convenience and “fun” of the factory_girl temptress. You will trend towards a simpler system and as a bonus (in fact, an incredible one) your test suite will likely be exponentially faster which, in turn, will breed simplicity by letting you have more feedback more often.

P.S. It shouldn’t go without mention that factories can be absolutely awesome for integration tests. Integration tests aren’t used for guiding system design nor testing in isolation so the drawbacks of these tools drop away. However, both factory_girl and Machinist use RSpec as some of their very first usage examples and this troubles me deeply.

P.P.S. A lot of these arguments can be applied to fixtures too. However, they usually don’t create hordes of objects invisibly and litter your environment with them. Also, they aren’t as slow. But yes, the fewer factories <em>and</em> fixtures in a test, the better.

<strong>Update for clarity</strong>: Firstly, I am absolutely just talking about unit tests. If you are testing code that <em>integrates</em> with ActiveRecord or number of levels of your stack, then factories and fixtures are certainly defensible (though I still prefer to steer clear). Secondly, I’ve tried to be careful about where I use the words simple, easy, complex, and difficult. For the definitions that I intend, please watch (at least the first 10 minutes of) <a href="http://www.infoq.com/presentations/Simple-Made-Easy">Simple Made Easy</a>.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>26 Feb 2012</time>
        
        <span class="ttl">&middot; 



  
	  4 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2011/12/new-design/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Dec 2011</time></div>
      <h3 class="f3 fw6 lh-title mb0">New design</h3>
      <p class="f5 fw3 lh-copy mv2">Just a quick post to point out the new design for this blog. It’s nothing special — I just needed a change.

Hopefully, the change of aesthetics will motivate me to get back into blogging.

Let me know if there is any weird display issues on your browser. I only tested the latest versions of non-IE browsers, but if there are any stupid obvious fixes to any browser, I’ll implement them.

Tell me what you think, keeping in mind I’m a developer not a designer :P.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>7 Dec 2011</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2011/07/hell-yes/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2011</time></div>
      <h3 class="f3 fw6 lh-title mb0">Hell yes</h3>
      <p class="f5 fw3 lh-copy mv2">Although long overdue, I’m here to tell you why I joined Obtiva and why
I think you should too.

About 10 months ago, I found myself looking for a job. I had plenty of
freelance work and plenty of time to find the right fit for myself. With
this in mind, I decided to adopt a new philosophy to apply in situations
like this.

I realised that you don’t always get the full potential out of life
until you <strong>face up to what you really want</strong> out of it.

The core principle of this outlook was inspired by reading <a href="http://sivers.org/hellyeah">a fantastic
blog post</a> that had one message: If you
can’t say “HELL YEAH!” to something, just say “No” instead.

This message resonated with me and helped me considerably to get what I
really wanted out of the next few months. I knew that what I really
wanted more than anything was to work with incredible people who
inspired and challenged me on a daily basis. I knew then and still do
now that if this basic need wasn’t met, I’d be looking for a new job
within a few months.

I knew that to make the best of my time, I had to take my time. I put
the word out to the world (via a <a href="http://bjeanes.com/2010/08/19/my-future">blog
post</a>) stating what I wanted
and began networking and contacting companies I thought I’d like.

One of the first things I did when I got on the phone with any potential
employer was to tell them that I would not be accepting any jobs
immediately. I wanted to take at least a few months to get a good feel
for the work places and the people of which they were comprised.

I was contacted by nine fantastic opportunities across the world. They
included opportunities in Sweden, Spain, Mexico, the USA, Canada, and my
home, Australia.

With each opportunity, I stated that I wanted to come to their office
(anywhere in the world) and spend a week working with the people who
would become my coworkers and on the projects that I would be a part of.

After several experiences at different locations, I had the pleasure of
spending a week in Chicago with the Obtivians. Finally, this was a place
I knew I wanted to work at. Obtiva has some of the most amazing people
I’ve had the pleasure of getting to know. Each of them is smart,
passionate, interesting, modest, and inspiring. I knew I could only come
out the other end of working with them a better developer and human
being than before.

Several of my visits with offices prior to Obtiva felt like interesting
and challenging places to work at, but none of them gave me an
overwhelming sensation of happiness and excitement as Obtiva did and
still does.

Ultimately, I don’t plan on being a consultant for most of my career,
but I know that as long as I am one, I want to be one with these guys.

So, face up to what you want. Say no until you are moved to say yes as
though by an external force (other than
coercion!). There’s no room for compromising on happiness, fulfillment, and personal growth.

Also, Obtiva kicks ass. If you are a passionate developer or have an interesting project, drop us a line, and let us move you to say “HELL YES!”
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>11 Jul 2011</time>
        
        <span class="ttl">&middot; 



  
	  2 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/11/restoring-ghost-entries-from-time-machine-backup/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Nov 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Restoring ghost entries from Time Machine backup</h3>
      <p class="f5 fw3 lh-copy mv2">Pat Allan just had some trouble with his laptop and he lost a bunch of
data.

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>27 Nov 2010</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/10/rails-bug-in-versions-1-2-and-3/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Oct 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Rails bug in versions 1, 2, and 3</h3>
      <p class="f5 fw3 lh-copy mv2">Want to know how to raise a 500 error in any version of rails (so far)?
Simply add <code class="highlighter-rouge">?a&amp;a[]</code> to the end of any URL in any Rails application.

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>24 Oct 2010</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/09/pausing-cucumber-scenarios-to-debug/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Pausing Cucumber Scenarios to Debug</h3>
      <p class="f5 fw3 lh-copy mv2">Continuing what I started with my <a href="http://bjeanes.com/2010/09/19/selector-free-cucumber-scenarios">post last
light</a>,
I’ve got another tip for developing productively when using Cucumber.

I’m going to show you a simple way to pause cucumber stories in order to
investigate the current state of your application at that point.

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">AfterStep</span><span class="p">(</span><span class="s1">'@pause'</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">print</span> <span class="s2">"Press Return to continue"</span>
  <span class="no">STDIN</span><span class="p">.</span><span class="nf">getc</span>
<span class="k">end</span>
</code></pre></div></div>

Then just tag any Cucumber feature or scenario with <code class="highlighter-rouge">@pause</code>. After the
first step is run, the scenario will stop running and you can do
whatever you like before proceeding.

My favourite tactic is to combine the <code class="highlighter-rouge">@pause</code> tag with <code class="highlighter-rouge">@selenium</code> tag
to have WebDriver stop driving FireFox for a moment and let me click
around in the application or inspect the HTML/CSS at that point.

My next post will be about enabling FireBug in the “WebDriver” profile
to help inspecting the web page when you’ve paused a scenario.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>20 Sep 2010</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/09/selector-free-cucumber-scenarios/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Selector-Free Cucumber Scenarios</h3>
      <p class="f5 fw3 lh-copy mv2"><small>(a Serbo-Croation translation by Anja Skrbaa is available <a href="http://science.webhostinggeeks.com/selektor-free">here</a>)</small>

I’ve been using Cucumber since pretty much the first day I heard about
it. I’ve worked on a lot of projects that have relied on it’s presence
for reliable development. Therefore, I’ve put a lot of effort into
perfecting my Cucumber infrastructure to make this fantastic tool even
better. I’m going to share one such morsel of code that makes developing
with Cucumber even greater.

<h2 id="the-problem">The Problem</h2>

I’ve worked on a lot of web applications and, as I’m sure many of you
know, quite often the development of a web application is focussed on
the functionality foremost, and the interface and style is incorporated
later. It may be that the client doesn’t yet know the feel they want for
their project or that they want to focus their budget towards
prototyping the application first.

This is fine, except for the fact that changing the HTML and CSS of a
web application after a lot of functionality has been developed is a
fantastic way to break all your integration tests.

This is particularly true if you have scenarios like the following
contrived one:

<div class="language-cucumber highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">When </span>I fill in <span class="s">"Username"</span> with <span class="s">"bjeanes"</span> within <span class="s">".main-panel form#signup-form"</span>
<span class="nf">And </span>I press <span class="s">"Sign up!"</span> within <span class="s">".main-panel form#signup-form"</span>
<span class="nf">Then </span>I should see <span class="s">"You have successfully signed up"</span> within <span class="s">".flash.notice"</span>
</code></pre></div></div>

The problem is, of course, that designers might change the HTML that
used to be <code class="highlighter-rouge">.main-panel form#signup-form</code> into something sexier and more
semantic.

<h2 id="the-solution">The Solution</h2>

This problem is not unlike an already-solved one; we’ve all moved away
from hardcoding URLs like “/users/new” into our views and Cucumber
scenarios and replacing them with <code class="highlighter-rouge">new_user_path</code> and <code class="highlighter-rouge">the signup page</code>,
respectively.

So why not apply the same formula that <code class="highlighter-rouge">paths.rb</code> uses for removing URLs
from scenarios to our situation with selectors?

Here’s what I add to all new projects:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># I'm in features/step_definitions/web_ext_steps.rb</span>

<span class="no">When</span> <span class="sr">/^(.*) within ([^:"]+)$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">step</span><span class="p">,</span> <span class="n">scope</span><span class="o">|</span>
  <span class="n">with_scope</span><span class="p">(</span><span class="n">selector_for</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span> <span class="k">do</span>
    <span class="no">When</span> <span class="n">step</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Multi-line version of above</span>
<span class="no">When</span> <span class="sr">/^(.*) within ([^:"]+):$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">step</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">table_or_string</span><span class="o">|</span>
  <span class="n">with_scope</span><span class="p">(</span><span class="n">selector_for</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span> <span class="k">do</span>
    <span class="no">When</span> <span class="s2">"</span><span class="si">#{</span><span class="n">step</span><span class="si">}</span><span class="s2">:"</span><span class="p">,</span> <span class="n">table_or_string</span>
  <span class="k">end</span>
<span class="k">end</span>  
</code></pre></div></div>

And:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># I'm in features/support/selectors.rb</span>

<span class="k">module</span> <span class="nn">HtmlSelectorsHelper</span>
  <span class="k">def</span> <span class="nf">selector_for</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">scope</span>
    <span class="k">when</span> <span class="sr">/the body/</span>
      <span class="s2">"html &gt; body"</span>
    <span class="k">else</span>
      <span class="k">raise</span> <span class="s2">"Can't find mapping from </span><span class="se">\"</span><span class="si">#{</span><span class="n">scope</span><span class="si">}</span><span class="se">\"</span><span class="s2"> to a selector.</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span>
        <span class="s2">"Now, go and add a mapping in </span><span class="si">#{</span><span class="kp">__FILE__</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">World</span><span class="p">(</span><span class="no">HtmlSelectorsHelper</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="applying-the-solution">Applying the Solution</h2>

My previous example of the flawed Cucumber scenario now becomes:

<div class="language-cucumber highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">When </span>I fill in <span class="s">"Username"</span> with <span class="s">"bjeanes"</span> within the sign up form
<span class="nf">And </span>I press <span class="s">"Sign up!"</span> within the sign up form
<span class="nf">Then </span>I should see <span class="s">"You have successfully signed up"</span> within the notice flash
</code></pre></div></div>

And the <code class="highlighter-rouge">selectors.rb</code> case statement gets the following additions:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span>
  <span class="c1"># ...</span>
  
  <span class="k">when</span> <span class="sr">/the sign up form/</span>
    <span class="s2">".main-panel form#signup-form"</span>
  <span class="k">when</span> <span class="sr">/the (notice|error|info) flash/</span>
    <span class="s2">".flash.</span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="s2">"</span>
  
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

Notice how the scenario now identifies things on our page by their
semantic identifiers, not by brittle CSS or XPath locations which are
prone to change. As a bonus, now <del>if</del> when they do change, the paths only need to be updated in a single
location in our Cucumber test suite!

<h2 id="patching-cucumber">Patching Cucumber</h2>

I feel pretty strongly that CSS and XPath don’t belong in our feature
files because not only does it encourage brittle tests (as shown above),
but also because those selectors are entirely irrelevant to end users,
and that’s kind of the main point of using a natural language DSL to
describe our integration tests, i.e. putting on the user shoes.

<del>
I’d really like to patch this back into Cucumber, and I entirely plan to
do so, providing I get the time.</del>

&lt;/del&gt;
I got the time, and here is my <a href="http://github.com/aslakhellesoy/cucumber-rails/pull/63">pull
request</a> to have
it merged.

<h2 id="expanding-the-solution">Expanding the Solution</h2>

You’ll note my <code class="highlighter-rouge">HtmlSelectorsHelper</code> module only accommodates CSS
selectors. That’s only because I have never needed XPath in this
context. It’d be very simple to modify my examples to do so, though,
with a combination of multiple return values and a splat. That’s an
exercise for the reader (or me if I end up patching Cucumber).

<h2 id="final-word">Final Word</h2>

I apologise for the length of this article, but I congratulate you for
making it all the way through it!

I now have so many blog post ideas lined up that I’ve had to create a
new category in Things.app just to hold them all. This means that I’ll
be striving to get a few more posts done and out the door in the next
few weeks, including a performance comparison of different data
encapsulations for web application APIs on the iPhone (i.e. is it better
to use Plists, JSON, or XML?) and a post on why I think there should be
8 RESTful actions, not the 7 that Rails prescribes by default.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>19 Sep 2010</time>
        
        <span class="ttl">&middot; 



  
	  3 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/08/options-to-improve-time-to-profit/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Aug 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Options to Improve Time To Profit</h3>
      <p class="f5 fw3 lh-copy mv2">I’ve needed to refer to this fantastic article a number of times and
have always had trouble finding the link, so I am posting it on my blog
because I think it’s something everyone trying to sell Agile to clients
should read and I know I’ll need it again.

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>30 Aug 2010</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/08/my-future/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Aug 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">My Future</h3>
      <p class="f5 fw3 lh-copy mv2"><h2 id="mocra">Mocra</h2>

Two weeks ago, Dr Nic informed me, and my coworkers, that <a href="http://drnicwilliams.com/2010/08/04/coming-to-america/">he had
accepted a job with
EngineYard</a> and
was moving to San Francisco within the month. Unfortunately, a
consequence of Nic’s wonderful opportunity is that he had to fire us all
and shutdown Mocra.

Of course, he broke the news to us in a more humane way, and even
encouraged me to take on the Mocra name and start a new company to
continue on without him. I haven’t ruled it out yet, but I am taking
this change as an opportunity to consider moving on in my career and
having some new experiences with fresh and inspiring people.

Over the last two years at Mocra, I’ve helped run the business, managed
the clients, and written awesome code, as well as worked on a slew of
<a href="http://github.com/bjeanes">open source contributions and projects</a>,
such as <a href="http://github.com/bjeanes/ghost">ghost</a>.

<h2 id="possibilities">Possibilities</h2>

A few opportunities and offers have presented themselves already, even
without having put myself out there, as I’m now trying. Some of them
have been quite tempting, and I’ve been exploring them, but some have
been less so.

After reading <a href="http://sivers.org/hellyeah">No more yes. It’s either HELL YEAH! or
no</a>, I’ve decided that I want to try to find
a job that’s will make me say “HELL
YEAH!” and go for it.

If you have a position or an endeavour that you think I might be right
for, please get in contact; I’d love to have a chat about the company,
idea, or your processes, and how we might be able to help each other.

I am looking for work starting from the beginning of September. My
long-term goal is to move out of Brisbane, so relocating is an option
I’d enthusiastically pursue. For a number of reasons, however, I’m tied
to Brisbane until about the end of the year.

Therefore, I’d love to find a company that can accommodate me as a
contractor for the few months until my partner and I are in a position
to move out of Brisbane, at which point I’d be eager to come on as a
full-timer. I am more than happy to come work on-site out of Brisbane
before the New Year for small stints, though.

If you want to know more, I’ll be making my
<a href="http://bjeanes.com/pages/about">About</a> page more relevant to my skills,
experiences, and interests over the next day or so. In the mean time,
feel free to <a href="me@bjeanes.com">email me</a> or call me on
<a href="skype://bojeanes?userinfo">skype</a> or +61412639224 to start a
conversation.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>19 Aug 2010</time>
        
        <span class="ttl">&middot; 



  
	  2 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/07/fix-locale-errors-on-linux/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Fix locale errors on linux</h3>
      <p class="f5 fw3 lh-copy mv2">Have you ever gotten error messages such as the following when running
commands such as <code class="highlighter-rouge">apt-get</code>?

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
 LANGUAGE = ,
 LC*ALL = ,
 LC*CTYPE = "en*US.UTF~~8",
 LANG = 
 are supported and installed on your system.
</code></pre></div></div>

I’ve had this problem quite a lot on my VPS boxes on Linode and
SliceHost. The solution is simple, simply run the following:

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">locale-gen en_US.UTF-8
update-locale LANG=en_US.UTF-8
</span></code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>8 Jul 2010</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/07/fix-encoding-errors-preventing-postgresql-database-creation/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Fix encoding errors preventing PostgreSQL database creation</h3>
      <p class="f5 fw3 lh-copy mv2">I recently was setting up a new VPS on Linode and I got the following
error when trying to create a new database:

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: new encoding is incompatible with the encoding of the template database
HINT: Use the same encoding as in the template database, or use template0 as template.
</code></pre></div></div>

This error is related to the locale of the system when Postgres was
installed. If you run the commands in my <a href="/2010/07/08/fix-locale-errors-on-linux">previous
post</a> before installing
Postgres, you should avoid these errors altogether.

If Postgres has already been installed, however, you can run the
following commands (assuming Postgres version 8.4) to reinitialise the
database with the correct encoding:

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">pg_dropcluster --stop 8.4 main
pg_createcluster --start -e UTF-8 8.4 main
</span></code></pre></div></div>

Note: this will erase all databases and reset your postgres
configuration so it is only really useful when you are first setting up
your database, or have taken appropriate measures to be able to restore
your data.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>8 Jul 2010</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/06/option-keyboard-shortcuts-for-terminal-and-iterm/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jun 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Option (&amp;#x2325;) keyboard shortcuts for Terminal and iTerm</h3>
      <p class="f5 fw3 lh-copy mv2">Throughout Mac OS X, almost every input field and text area have
consistent keyboard shortcuts to navigate and edit the text. However, in
both Terminal and iTerm, some of these don’t work like you might be used
to. Furthermore, both iTerm and Terminal respond differently to each
other, as well as to hour the rest of the system does it.

Three shortcuts I’ve especially missed are: Option-Left to move left one
word, Option-Right to move right one word, and Option-Backspace to
delete one word to the left.

The ideal solution to get these working as I’d like would be to
configure an <code class="highlighter-rouge">inputrc</code> file. However, after playing around for a few
hours, I still couldn’t get this working reliably using the Option key.
So, my fallback is to configure the terminal apps to do this themselves.

If you set up the terminal applications to use Option as the Meta key,
some remote systems will already work with the keyboard shortcuts I
want. However, locally only the Option-Backspace one works and even then
it only works out of the box in Terminal.

So, here’s how to get all three working in both Terminal and iTerm,
locally and on remote systems:

<h2 id="terminal">Terminal</h2>

First, enable Option as meta key option by going to the *Preferences &gt;
Settings &gt; Your Profile &gt; Keyboard( and checking “Use option as meta
key” check box. This will get Option-Backspace working.

Next, while still in the Keyboard settings from the last step, press the
<ul>
  <li>button. In the popup, choose “cursor left” for the Key, “option” for
the Modifier, and “send string to shell:” for the Action. In the text
field, type Esc then lowercase B key and press OK. This will get the
Option-Left shortcut working.</li>
</ul>

To enable the Option-Right shortcut, repeat the previous step, instead
choosing “cursor right” for the Key, and typing Esc then lowercase F in
the text field.

If you switch Terminal themes, you will have to repeat these steps for
the new theme.

<h2 id="iterm">iTerm</h2>

For the iTerm configuration, I will simply point you to <a href="http://greyworld.net/en/blog/iterm-word-shortcuts/">this excellent
article</a> which help
me get up and running. The sections that correspond to the shortcuts I
set up are 2.1, 2.2, and 2.4.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>26 Jun 2010</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2010/02/automatically-open-the-last-page-for-failed-scenarios/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Feb 2010</time></div>
      <h3 class="f3 fw6 lh-title mb0">Automatically open the last page for failed scenarios</h3>
      <p class="f5 fw3 lh-copy mv2">When writing new Cucumber scenarios, developers will usually start with
a failing scenario, incrementally making it pass, step by step. If this
is a common workflow for you, you’ll probably have noticed a trend of
having to re-run it each time a new step is failing, adding something
like <code class="highlighter-rouge">Then show me the page</code> after the last
passing step to see why the story is currently failing.

<a href="http://chendo.net">Chendo</a> and I came up with a nifty little solution
in just a few lines that really helps this process of seeing what webrat
sees when a scenario fails. Throw this snippet of code in a file in your
<code class="highlighter-rouge">features/support/</code> directory:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">After</span> <span class="k">do</span> <span class="o">|</span><span class="n">scenario</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">scenario</span><span class="p">.</span><span class="nf">respond_to?</span> <span class="o">&amp;&amp;</span> <span class="n">scenario</span><span class="p">.</span><span class="nf">status</span> <span class="o">==</span> <span class="ss">:failed</span>
    <span class="n">save_and_open_page</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>11 Feb 2010</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/12/australias-mandatory-internet-filter/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Dec 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Australia&#39;s Mandatory Internet Filter</h3>
      <p class="f5 fw3 lh-copy mv2">I apologise to those who are uninterested for the rant that follows:

I can not stand nor hardly believe that the current government of my
otherwise awesome country would choose to completely ignore the advice
and expertise of industry professionals and the interests of the voters.

Today Steven Conroy, the Australian Minister of Communications, managed
to get a piece of legislation <del>passed</del> introduced that will require
all Australian ISPs to participate in the mandatory filtering of content
delivered to Australian citizen. Welcome to the likes of Iran and China.

The legislation has been disguised as a measure to protect children from
porn and the likes, despite repeated advice from industry professionals
that it will do little to curb illegal content, cost the tax payers
millions of dollars and ultimately make legal browsing a slower and
inferior experience than it already is.

Furthermore, the government has made a effort to <a href="http://www.smh.com.au/articles/2009/03/17/1237054787635.html?page=fullpage">actively
suppress</a>
the contents of the block list, keeping those affected (read: everyone)
completely in the dark at to how it will affect their experience. The
block list was leaked and shown to include content about which the
government should have no say in how or why it is viewed such as some
youtube videos, topics on Euthanasia, a gay dating site, flash and
downloadable games, and sexual education material (contraceptives, etc).

To the Rudd government:

This is not good enough. I am a voter and a tax payer and I will not
stand for this. I will actively participate in removing this ridiculous
action and I will march the streets to show my support for an
unrestricted flow of information like the rest of the world will
continue to enjoy. I will show other tax payers how you have wasted $40
million (or more) of their money on a piece of technology no one wants
and that will not work and remind them that this is done in a time of
financial uncertainty instead of focusing on real issues like our carbon
footprint as a nation. I have the knowledge and the will to undermine
this pointless act, and I will use them to do so.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>15 Dec 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/11/iterative-html5-turning-a-comma-separated-list-into-a-semantic-list/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Nov 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Iterative HTML5 - Turning a comma-separated list into a semantic list</h3>
      <p class="f5 fw3 lh-copy mv2">In the process of going through the redesign of <a href="http://mocra.com">http://mocra.com</a>, I keep finding better ways to make
the HTML more semantic.

<a href="http://chendo.net">Jack Chen</a> and I have been turning the design into 
HTML over the last few days and we’ve been striving to be as semantic as
possible by taking advantage of new HTML5 elements and by separating the
content further from the design code with all the new CSS3 selectors.

Here’s an example of something we just did to make the HTML cleaner and
more meaningful, whilst still maintaining the look and style.

Here’s what we are styling:

<img src="http://img.skitch.com/20091112-qujhy29f4e5mkpradfd3hb9hnj.jpg" alt="image" />

Usually your HTML (or HAML in this case) would look something like this:

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">%footer</span>
  <span class="nt">%aside</span>
    <span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Dr Nic Williams'</span><span class="p">,</span> <span class="s1">'http://drnicwilliams.com/'</span>
    ,
    <span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Bodaniel Jeanes'</span><span class="p">,</span> <span class="s1">'http://bjeanes.com/'</span>
    ,
    <span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Jack Chen'</span><span class="p">,</span> <span class="s1">'http://chendo.net/'</span>
    ,                      
    <span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Ryan Bigg'</span><span class="p">,</span> <span class="s1">'http://frozenplague.net/'</span>
</code></pre></div></div>

However, we can make this <strong>list</strong> of people more semantic by using an
<code class="highlighter-rouge">&lt;ul&gt;</code> element and some CSS magic.

Here’s what the new HTML (HAML here) would look like:

<div class="language-haml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">%footer</span>
  <span class="nt">%aside</span>
    <span class="nt">%ul</span>
      <span class="nt">%li</span><span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Dr Nic Williams'</span><span class="p">,</span> <span class="s1">'http://drnicwilliams.com/'</span>
      <span class="nt">%li</span><span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Bodaniel Jeanes'</span><span class="p">,</span> <span class="s1">'http://bjeanes.com/'</span>
      <span class="nt">%li</span><span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Jack Chen'</span><span class="p">,</span>       <span class="s1">'http://chendo.net/'</span>
      <span class="nt">%li</span><span class="p">=</span> <span class="n">link_to</span> <span class="s1">'Ryan Bigg'</span><span class="p">,</span>       <span class="s1">'http://frozenplague.net/'</span>
</code></pre></div></div>

And the CSS (Sass here):

<div class="language-sass highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">body</span>
  <span class="nt">footer</span>
    <span class="nt">aside</span>
      <span class="nl">padding-top</span><span class="p">:</span> <span class="m">6px</span>
      <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span>

      <span class="nt">ul</span>
        <span class="nl">list-style</span><span class="p">:</span> <span class="nb">none</span>
        <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span>
        <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span>
      
        <span class="nt">li</span>
          <span class="nl">display</span><span class="p">:</span> <span class="nb">inline</span>
          
          <span class="k">&amp;</span><span class="nd">:after</span>
            <span class="nl">content</span><span class="p">:</span> <span class="s2">","</span>
            
          <span class="k">&amp;</span><span class="nd">:last-child:after</span>
            <span class="nl">content</span><span class="p">:</span> <span class="s2">""</span>
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>12 Nov 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/11/using-partial-layouts-to-dry-out-your-views/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Nov 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Using partial layouts to DRY out your views</h3>
      <p class="f5 fw3 lh-copy mv2">The other day we got some HTML from the designer of one of our clients
to implement as the new UI for an app we are building at
<a href="http://mocra.com/">Mocra</a>. Overall the HTML was good but implementing
it started to feel a little moist (i.e. not DRY).

For example, around all the apps form the client’s design had a rounded
white box, the HTML of which went something like this:

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-wht"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-wht-inside"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fieldset&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"frow"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;label&gt;</span>Currency:<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">"fs"</span><span class="nt">&gt;&lt;option&gt;</span>EUR<span class="nt">&lt;/option&gt;&lt;/select&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"frow frlast"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;label&gt;</span>File:<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">""</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"cround"</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/images/round-corners-bottom.gif"</span> <span class="na">alt=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

It’s a lot of <code class="highlighter-rouge">div</code> tags to have to repeat around every form that has
this style. Luckily a nice feature of Rails partials can help out.
Create a shared partial file that will act as a layout like this:

<div class="language-rhtml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- app/views/shared/_fieldset.html.erb --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-wht"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-wht-inside"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;fieldset&gt;</span>
            <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"cround"</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/images/round-corners-bottom.gif"</span> <span class="na">alt=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

Then in your views that need to have this white box, simply wrap your
content in that layout like so:

<div class="language-rhtml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">render</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="s1">'shared/fieldset'</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"frow"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label&gt;</span>Currency:<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">"fs"</span><span class="nt">&gt;&lt;option&gt;</span>EUR<span class="nt">&lt;/option&gt;&lt;/select&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"frow frlast"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label&gt;</span>File:<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">""</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="c">&lt;!-- Or, if the inner content is already in a partial --&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span><span class="p">,</span> <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s1">'form'</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="s1">'shared/fieldset'</span> <span class="cp">%&gt;</span>
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>5 Nov 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/11/64-bit-postgres-and-rails-on-snow-leopard/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Nov 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">64-bit Postgres and Rails on Snow Leopard </h3>
      <p class="f5 fw3 lh-copy mv2"><h3 id="dependencies">Dependencies</h3>

Install the GEOS and PROJ frameworks from
<a href="http://www.kyngchaos.com/software:frameworks">here</a>

<h3 id="postgres">Postgres</h3>

<h4 id="download-and-compile">Download and Compile</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://ftp2.au.postgresql.org/pub/postgresql/source/v8.4.1/postgresql-8.4.1.tar.bz2 | <span class="nb">tar </span>xjf -
<span class="nb">cd </span>postgresql-8.4.1
./configure
make <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>make install
</code></pre></div></div>

The files are now all installed in the right places, onwards to making
them usable!

<h4 id="create-a-postgres-user-and-group">Create a <code class="highlighter-rouge">postgres</code> User and Group</h4>

This is adjusted from the instructions in the comments
<a href="http://www.postgresql.org/docs/8.3/interactive/postgres-user.html">here</a>).

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Find unused Group ID and User ID:</span>
<span class="nb">export </span><span class="nv">GROUPID</span><span class="o">=</span><span class="sb">`</span><span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-list</span> /Groups PrimaryGroupID | ruby <span class="nt">-e</span> <span class="s1">'puts STDIN.read.scan(/\d+/m).map{|i|i.to_i}.uniq.sort.last.succ'</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">USERID</span><span class="o">=</span><span class="sb">`</span><span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-list</span> /Users UniqueID | ruby <span class="nt">-e</span> <span class="s1">'puts STDIN.read.scan(/\d+/m).map{|i|i.to_i}.uniq.sort.last.succ'</span><span class="sb">`</span>

<span class="c"># Create group:</span>
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Groups/_postgres
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Groups/_postgres PrimaryGroupID <span class="nv">$GROUPID</span>
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-append</span> /Groups/_postgres RecordName postgres

<span class="c"># Create user:</span>
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Users/_postgres
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Users/_postgres UniqueID <span class="nv">$USERID</span>
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Users/_postgres PrimaryGroupID <span class="nv">$GROUPID</span>
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Users/_postgres UserShell /bin/bash
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Users/_postgres RealName <span class="s2">"PostgreSQL Server"</span>
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-create</span> /Users/_postgres NFSHomeDirectory /usr/local/pgsql
<span class="nb">sudo </span>dscl <span class="nb">.</span> <span class="nt">-append</span> /Users/_postgres RecordName postgres
</code></pre></div></div>

That’s the clean way of making a user (so it doesn’t show up in your
Accounts preference pane, etc.

<h4 id="clean-up">Clean up</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>touch /var/log/psql.log
<span class="nb">sudo </span>mkdir /usr/local/pgsql/data
<span class="nb">sudo </span>chown <span class="nt">-R</span> postgres:postgres /usr/local/pgsql/data /var/log/psql.log

<span class="c"># Put Postgres in your path</span>
<span class="nb">export</span> <span class="nv">$PATH</span><span class="o">=</span><span class="s2">"/usr/local/pgsql/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">sudo </span>sh <span class="nt">-c</span> <span class="s1">'echo /usr/local/pgsql/bin &gt; /etc/paths.d/pgsql'</span>
</code></pre></div></div>

Thanks to Apple we have a nice way of setting the PATH across the entire
system so every app should now know how to find the Postgres binaries
and the data directory is now set up to store the database files — now,
we just need to create them.

<h4 id="initialise-the-database">Initialise the Database</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Become the postgres user</span>
<span class="nb">sudo </span>su - postgres

<span class="c"># If this throws next commant throws an error about shared memory, </span>
<span class="c"># try putting "these lines":http://gist.github.com/224815 into </span>
<span class="c"># /etc/sysctl.conf, rebooting, and trying again:</span>
initdb <span class="nt">-D</span> /usr/local/pgsql/data <span class="nt">-E</span> UTF8

<span class="c"># Start the database</span>
postgres <span class="nt">-D</span> /usr/local/pgsql/data <span class="o">&gt;</span>/var/log/psql.log 2&gt;&amp;1 &amp;

<span class="c"># Create a test database and check you can connect to it</span>
createdb <span class="nb">test
</span>psql <span class="nb">test</span>

<span class="c"># Just create a superuser for general dev tasks</span>
createuser postgres

<span class="c"># we don't want to be the postgres user anymore</span>
<span class="nb">exit</span>
</code></pre></div></div>

Your done with the Postgres setup now!

<h3 id="postgis">PostGIS</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://postgis.refractions.net/download/postgis-1.3.7SVN.tar.gz | <span class="nb">tar </span>xzf -
<span class="nb">cd </span>postgis-1.3.7SVN
./configure <span class="nt">--with-geosconfig</span><span class="o">=</span>/Library/Frameworks/GEOS.framework/unix/bin/geos-config <span class="nt">--with-projdir</span><span class="o">=</span>/Library/Frameworks/PROJ.framework/unix
make <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>make install
</code></pre></div></div>

Phew! That one was easy.

<h3 id="postgres-ruby-gem">Postgres Ruby Gem</h3>

This is the part that everyone cares about the most. If this works your
Rails apps should start working like a charm.

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>env <span class="nv">ARCHFLAGS</span><span class="o">=</span><span class="s1">'-arch x86_64'</span> gem install pg
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>3 Nov 2009</time>
        
        <span class="ttl">&middot; 



  
	  2 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/10/using-fish-shells-event-system-to-behave-like-method-missing/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Oct 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Using Fish shell&#39;s event system to behave like method_missing</h3>
      <p class="f5 fw3 lh-copy mv2">Dr Nic’s latest post, <a href="http://drnicwilliams.com/2009/10/07/hash-bang-cucumber/">hash bang
cucumber</a>,
reminded me of a piece of hax I whipped up a few weeks ago with Ruby and
Fish Shell.

Fish has an event system that allows you to register functions to be
auto-run after or during certain events (such as when a particular
environment variable is changed). One of this events is called
<code class="highlighter-rouge">fish_command_not_found</code>. It is triggered whenever you type a
non-existant command into the prompt.

With this in mind, you can trigger certain commands to run by matching
what fish couldn’t manage to run automatically by catching this event.

For instance:

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>__fish_method_missing <span class="nt">--on-event</span> fish_command_not_found
  method_missing <span class="nv">$argv</span>
end

funcsave method_missing
</code></pre></div></div>

Given that function is created (simply paste the whole code block into
your Fish terminal), I can now create a command called
<code class="highlighter-rouge">method_missing</code> (or whatever you call inside your
<code class="highlighter-rouge">__fish_method_missing</code>) and place it somewhere in your <code class="highlighter-rouge">$PATH</code> — I like
<code class="highlighter-rouge">~/.config/fish/bin</code>.

My <code class="highlighter-rouge">method_missing</code> binary is simply something like this:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env ruby</span>

<span class="n">command</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">shift</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Running </span><span class="si">#{</span><span class="n">cmd</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2"> instead"</span>
  <span class="nb">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">case</span> <span class="n">command</span>
<span class="k">when</span> <span class="sr">/^git(@|:\/\/).*\.git$/</span>
  <span class="n">run</span><span class="p">(</span><span class="s2">"git clone </span><span class="si">#{</span><span class="n">command</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">when</span> <span class="sr">/^(?:ftp|https?):\/\/.+\.t(?:ar\.)?gz$/</span>
  <span class="n">run</span><span class="p">(</span><span class="s2">"curl </span><span class="si">#{</span><span class="n">command</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2"> | tar xzv"</span><span class="p">)</span>
<span class="k">else</span>
  <span class="vg">$stderr</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"No default action defined in </span><span class="si">#{</span><span class="kp">__FILE__</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">abort</span>
<span class="k">end</span>
</code></pre></div></div>

Each command you want to register just becomes a new <code class="highlighter-rouge">when</code>
statement. For instance, to implement the functionality Dr Nic was
trying to achieve, I simply modify the <code class="highlighter-rouge">case</code> block as such:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">command</span>
<span class="k">when</span> <span class="sr">/^[a-z0-9_\-\/]+\.feature(:\d+)?$/</span>
  <span class="n">run</span><span class="p">(</span><span class="s2">"cucumber </span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="c1"># ... </span>
<span class="k">end</span>
</code></pre></div></div>

The existing entries I have in my <code class="highlighter-rouge">method_missing</code> command will
auto-clone the repository of a pasted Git URL and download and expand a
URL for a tar file, respectively. Not too shabby, and dead easy to
implement
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>7 Oct 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/10/gotcha-with-hash-new-when-providing-a-default-value/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Oct 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Gotcha with Hash.new when providing a default value</h3>
      <p class="f5 fw3 lh-copy mv2">For a project I am working on at the moment, I needed a <code class="highlighter-rouge">Hash</code>
that returned a different default value, i.e. not <code class="highlighter-rouge">nil</code>.
Specifically, I needed it to return another <code class="highlighter-rouge">Hash</code>, and for that
internal <code class="highlighter-rouge">Hash</code>’s default value to be an <code class="highlighter-rouge">Array</code>, like so:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span> <span class="o">=</span> <span class="c1"># ...</span>
<span class="nb">p</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">class</span>                              <span class="c1">#=&gt; Hash</span>
<span class="nb">p</span> <span class="nb">hash</span><span class="p">[</span><span class="ss">:non_existant_key</span><span class="p">].</span><span class="nf">class</span>           <span class="c1">#=&gt; Hash</span>
<span class="nb">p</span> <span class="nb">hash</span><span class="p">[</span><span class="ss">:another</span><span class="p">][</span><span class="ss">:non_existant_key</span><span class="p">].</span><span class="nf">class</span> <span class="c1">#=&gt; Array</span>
</code></pre></div></div>

Naïvely, I threw this into my code, and went along my merry way:
<code class="highlighter-rouge">entries = Hash.new(Hash.new([]))</code>. A few days later, I came back
to this code to finish it and realised that something was awry with the
values I was getting out of the <code class="highlighter-rouge">Hash</code>. It took me a while to figure it
out because the values were all integers being summed together and I was
never looking or setting the values directly.

However, eventually I saw a pattern — many of the values were the same.
For instance, given the following assignments, I should expect
<code class="highlighter-rouge">[ruby]p entries[153][:monday] #=&gt; [12.hours]</code>:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">entries</span><span class="p">[</span><span class="mi">153</span><span class="p">][</span><span class="ss">:monday</span><span class="p">]</span>  <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">.</span><span class="nf">hours</span>
<span class="n">entries</span><span class="p">[</span><span class="mi">153</span><span class="p">][</span><span class="ss">:tuesday</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">.</span><span class="nf">hours</span>
<span class="n">entries</span><span class="p">[</span><span class="mi">87</span><span class="p">][</span><span class="ss">:monday</span><span class="p">]</span>   <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">.</span><span class="nf">hours</span>
<span class="n">entries</span><span class="p">[</span><span class="mi">87</span><span class="p">][</span><span class="ss">:tuesday</span><span class="p">]</span>  <span class="o">&lt;&lt;</span> <span class="mf">2.5</span><span class="p">.</span><span class="nf">hours</span>
</code></pre></div></div>

However, what I found was the following:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">p</span> <span class="n">entries</span><span class="p">[</span><span class="mi">153</span><span class="p">][</span><span class="ss">:monday</span><span class="p">]</span>  <span class="c1">#=&gt; [12.hours, 3.hours, 7.hours, 2.5.hours]</span>
<span class="nb">p</span> <span class="n">entries</span><span class="p">[</span><span class="mi">153</span><span class="p">][</span><span class="ss">:tuesday</span><span class="p">]</span> <span class="c1">#=&gt; [12.hours, 3.hours, 7.hours, 2.5.hours]</span>
<span class="nb">p</span> <span class="n">entries</span><span class="p">[</span><span class="mi">87</span><span class="p">][</span><span class="ss">:monday</span><span class="p">]</span>   <span class="c1">#=&gt; [12.hours, 3.hours, 7.hours, 2.5.hours]</span>
<span class="nb">p</span> <span class="n">entries</span><span class="p">[</span><span class="mi">87</span><span class="p">][</span><span class="ss">:tuesday</span><span class="p">]</span>  <span class="c1">#=&gt; [12.hours, 3.hours, 7.hours, 2.5.hours]</span>

<span class="c1"># And in fact:</span>
<span class="nb">p</span> <span class="n">entries</span><span class="p">[</span><span class="ss">:any</span><span class="p">][</span><span class="ss">:thing</span><span class="p">]</span>  <span class="c1">#=&gt; [12.hours, 3.hours, 7.hours, 2.5.hours]</span>
</code></pre></div></div>

Let that soak in for a second. <code class="highlighter-rouge">Hash.new({})</code> uses the <strong>same
instance</strong> of the internal <code class="highlighter-rouge">Array</code> as the default value for each
of the inner-most keys. It also doesn’t set the key you want so
<code class="highlighter-rouge">p entries</code> still printed <code class="highlighter-rouge">{}</code>. In retrospect, it is
blatantly obvious that it does this, but the ramifications are still
huge.

The way to get the intended effect is of course to use the block syntax
of <code class="highlighter-rouge">[ruby]Hash.new</code> which, while much uglier, definitely works as
expected:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">entries</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span><span class="o">|</span><span class="nb">hash</span><span class="p">,</span> <span class="n">key</span><span class="o">|</span> <span class="nb">hash</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span><span class="o">|</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="o">|</span> <span class="n">h</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">}}</span>
<span class="n">entries</span><span class="p">[</span><span class="mi">153</span><span class="p">][</span><span class="ss">:monday</span><span class="p">]</span>  <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">.</span><span class="nf">hours</span>
<span class="n">entries</span><span class="p">[</span><span class="mi">153</span><span class="p">][</span><span class="ss">:tuesday</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">.</span><span class="nf">hours</span>
<span class="n">entries</span><span class="p">[</span><span class="mi">87</span><span class="p">][</span><span class="ss">:monday</span><span class="p">]</span>   <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">.</span><span class="nf">hours</span>
<span class="n">entries</span><span class="p">[</span><span class="mi">87</span><span class="p">][</span><span class="ss">:tuesday</span><span class="p">]</span>  <span class="o">&lt;&lt;</span> <span class="mf">2.5</span><span class="p">.</span><span class="nf">hours</span>

<span class="nb">p</span> <span class="n">entries</span> <span class="c1">#=&gt; {87=&gt;{:monday=&gt;[7.hours], :tuesday=&gt;[2.5.hours]}, 153=&gt;{:monday=&gt;[12.hours], :tuesday=&gt;[3.hours]}}</span>
</code></pre></div></div>

Wow. Obvious, but good to remember. I am sure most of you have had this
issue before, but I think it is still worthy of mention…
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>1 Oct 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/10/code-formatting-in-rss-feeds/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Oct 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Code formatting in RSS Feeds</h3>
      <p class="f5 fw3 lh-copy mv2">Apologies readers — I just realised that the code formatting is kinda
screwed up in RSS feeds because I am using some HTML5 elements to
represent my code blocks and using CSS to style them appropriately on
the site. The RSS feeds obviously lack these stylesheets and so look
pretty crap. I am not sure what the best solution is yet. Perhaps I
embed a <code class="highlighter-rouge">&lt;style&gt;</code> in each RSS post or simply have the RSS feeds
only show an excerpt of the full post.

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>1 Oct 2009</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/09/proof-that-chendo-is-a-robot/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Proof that @chendo is a robot</h3>
      <p class="f5 fw3 lh-copy mv2">Today I casually tweeted a hypothesis that
<a href="http://twitter.com/chendo">@chendo</a> drained my battery. The image below
shows the amusing responses that followed:

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>4 Sep 2009</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/09/using-apache-as-a-basicauth-proxy-to-an-internal-resource/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Sep 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Using Apache as a BasicAuth proxy to an internal resource</h3>
      <p class="f5 fw3 lh-copy mv2">This article isn’t named ideally so if you have a better title, tell me.

This is the scenario: we have a simple HTTP resource on the internal
network at <a href="http://mocra.com">Mocra</a>. This resource is a closed source
tool which is great except that it has one drawback — there are only two
security modes: basic authentication on, or basic authentication off.
There is only one username/password and you can’t control when or by
whom it is required.

Now, my preferred behaviour here is to be able to give out multiple
login/passwords and also to only require authentication <strong>outside</strong> of
our local network. I set out to get this working.

I devised this solution a few months ago (which is why it’s using Apache
at all) but I thought it might be of some use to someone. I created an
Apache VirtualHost to act as a proxy between this resource and its
clients. It looks like this:

<div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nl">VirtualHost</span><span class="sr"> *:80</span><span class="p">&gt;
</span>  <span class="c"># This virtual host proxies requests for the internal resource</span>
  <span class="nc">ServerName</span> external.resource.com

  <span class="c"># Set auth header to base64 encoded 'username:password' </span>
  <span class="c"># where username and password are the credentials for internal resource</span>
  <span class="nc">RequestHeader</span> <span class="ss">set</span> Authorization "Basic dXNlcm5hbWU6cGFzc3dvcmQ="

  <span class="nc">ProxyPass</span> /resource_path/ http://192.168.1.123:1337/resource_path/
  <span class="nc">ProxyPassReverse</span> /resource_path/ http://192.168.1.123:1337/resource_path/

  <span class="p">&lt;</span><span class="nl">Location</span><span class="sr"> /</span><span class="p">&gt;
</span>    <span class="nc">Order</span> allow,deny
    <span class="nc">Allow</span> <span class="ss">from</span> 192.168.1.0/24 <span class="c"># our local subnet</span>
    <span class="nc">Allow</span> <span class="ss">from</span> 127.0.0.1 <span class="c"># duh</span>
    <span class="nc">Allow</span> <span class="ss">from</span> 1.3.3.7 <span class="c"># our external router IP</span>

    <span class="nc">AuthType</span> basic
    <span class="nc">AuthName</span> "Our Internal Resource"
    <span class="c"># where all the external login/passwords are</span>
    <span class="nc">AuthUserFile</span> /var/www/.htpasswd 
    Require <span class="ss">valid-user</span>

    <span class="c"># this is the secret sauce that allows EITHER</span>
    <span class="c"># local access or Basic Auth access</span>
    <span class="nc">Satisfy</span> Any 
  &lt;/Location&gt;

  <span class="nc">RewriteEngine</span> <span class="ss">on</span>
  <span class="nc">RewriteRule</span> ^/?$ http://external.resource.com:80/resource_path/ [R]
<span class="p">&lt;/</span><span class="nl">VirtualHost</span><span class="p">&gt;
</span></code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>2 Sep 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/using-fields-for-can-generate-invalid-html/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Using fields_for can generate invalid HTML</h3>
      <p class="f5 fw3 lh-copy mv2">Just a quick post so show you how <code class="highlighter-rouge">fields_for</code> form
helper can cause invalid HTML when used in combination with
<code class="highlighter-rouge">accepts_nested_attributes_for</code> in your views.

If you are for any reason editing/creating your child objects in a
tabular form, your view might look something like this:

<div class="language-rhtml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@todo_list</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span>      <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>

  <span class="nt">&lt;h3&gt;</span>To Do Items:<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;</span>To Do Item<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Due Date<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Done?<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="cp">&lt;%</span> <span class="n">f</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:items</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">item</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:content</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">item</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:due_date</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">item</span><span class="p">.</span><span class="nf">check_box</span>  <span class="ss">:done</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
  
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="s1">'Save'</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

At first glance this looks fine. However, when the <code class="highlighter-rouge">ToDoList</code>
model has <code class="highlighter-rouge">accepts_nested_attributes_for :items</code>, the
<code class="highlighter-rouge">fields_for</code> helper also outputs a hidden field for each
existing <code class="highlighter-rouge">Item</code> instance with it’s ID.

This means that we get the following HTML:

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/to_do_lists/1"</span> <span class="na">class=</span><span class="s">"edit_to_do_list"</span> <span class="na">id=</span><span class="s">"edit_to_do_list_1"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"margin:0;padding:0;display:inline"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"put"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"CE2jyRoewbwsqu4eX8AFWFqsgrMfCN35Jzy6b43MhsA="</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"to_do_list_name"</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_name"</span> <span class="na">name=</span><span class="s">"to_do_list[name]"</span> <span class="na">size=</span><span class="s">"30"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"Sup"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;h3&gt;</span>To Do Items:<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;</span>To Do Item<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Due Date<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;</span>Done?<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_0_id"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][0][id]"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_0_content"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][0][content]"</span> <span class="na">size=</span><span class="s">"30"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"arst"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_0_due_date"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][0][due_date]"</span> <span class="na">size=</span><span class="s">"30"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"2009-07-30"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][0][done]"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="nt">/&gt;&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_0_done"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][0][done]"</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_1_id"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][1][id]"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"2"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_1_content"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][1][content]"</span> <span class="na">size=</span><span class="s">"30"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"arst"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_1_due_date"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][1][due_date]"</span> <span class="na">size=</span><span class="s">"30"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"2009-07-30"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
          <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][1][done]"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="nt">/&gt;&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_1_done"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][1][done]"</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
  
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Save"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

The keen eye will notice the hidden <code class="highlighter-rouge">&lt;input&gt;</code> tags that are direct
children of the <code class="highlighter-rouge">tbody</code>:

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;tbody&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_0_id"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][0][id]"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;tr&gt;</span><span class="c">&lt;!-- clip! --&gt;</span><span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"to_do_list_items_attributes_1_id"</span> <span class="na">name=</span><span class="s">"to_do_list[items_attributes][1][id]"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"2"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;tr&gt;</span><span class="c">&lt;!-- clip! --&gt;</span><span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
</code></pre></div></div>

This is not a valid place for an <code class="highlighter-rouge">&lt;input&gt;</code> tag.

I’ve put an example project demonstrating this on <a href="http://github.com/bjeanes/fields_for_invalid_html">my
GitHub</a>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>30 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/ultraviolet-tools/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Ultraviolet Tools</h3>
      <p class="f5 fw3 lh-copy mv2">A few weeks ago, I was modifying my clone of Enki (my blogging platform)
to use <a href="http://ultraviolet.rubyforge.org/">Ultraviolet</a> instead of
<a href="http://coderay.rubychan.de/">CodeRay</a>, as it supports using both
<a href="http://macromates.com">TextMate</a> themes and syntaxes. This means I can
extend it fairly limitlessly and use TextMate itself to modify the
themes an syntaxes.

However, Ultraviolet doesn’t come with the best tools to turn the
TextMate syntax and theme files into files Ultraviolet can use, and the
ones that it does provide puts those translated files INTO the gem on
your system. This means that you can’t easily deploy or share them.

So, to remedy this I made a small gem <a href="http://github.com/bjeanes/ultraviolet-tools">Ultraviolet
Tools</a> that provides two
command line tools: <code class="highlighter-rouge">uv-create-syntax</code> and <code class="highlighter-rouge">uv-create-theme</code>.

They aren’t very complicated, nor very documented, but they are
straight-forward to use:

<h3 id="install">Install</h3>

Install Ultraviolet Tools with
<code class="highlighter-rouge">sudo gem install bjeanes-ultraviolet-tools -s http://gems.github.com</code>.

<h3 id="usage">Usage</h3>

<h4 id="themes">Themes</h4>

Run <code class="highlighter-rouge">uv-create-theme path/to/theme.tmTheme</code>

<h4 id="syntaxes">Syntaxes</h4>

Run <code class="highlighter-rouge">uv-create_syntax path/to/syntax.plist</code> or
<code class="highlighter-rouge">uv-create_syntax path/to/bundle/with/syntaxes.tmBundle</code>

<h3 id="using-the-resulting-files">Using the resulting files</h3>

Use <a href="http://github.com/bjeanes/ultraviolet">my fork of ultraviolet</a> as
it has an option to change the load path for themes and syntaxes so that
you can load them out of your application files.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>30 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/creating-new-postgres-user-and-db/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Creating new Postgres User and DB</h3>
      <p class="f5 fw3 lh-copy mv2">This post is mostly a reminder for me in the future. However, others may
find it useful also.

I love Postgres but more often than not I get frustrated and confused
trying to get authentication working with a new database. By looking
through the Deprec source code, I pulled out these two lines of code and
so far they haven’t failed me:

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su - postgres <span class="nt">-c</span> <span class="s2">"createuser -P -D -A -E </span><span class="nv">$DBUSER</span><span class="s2">"</span>
su - postgres <span class="nt">-c</span> <span class="s2">"createdb -O </span><span class="nv">$DBUSER</span><span class="s2"> </span><span class="nv">$DBNAME</span><span class="s2">"</span>
</code></pre></div></div>

Of course, replace <code class="highlighter-rouge">$DBUSER</code> and
<code class="highlighter-rouge">$DBNAME</code> with your desired username and database
name, or define them as shell variables. The
<code class="highlighter-rouge">$DBUSER</code> creates that user as the owner of the
database (so it has permission to read/write etc).
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>21 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/fix-for-dynamic-pager-cannot-open-swap-directory-private-var-vm-in-os-x-possibly-just-snow-leopard/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Fix for &quot;dynamic_pager: cannot open swap directory /private/var/vm&quot; in OS X (possibly just Snow Leopard)</h3>
      <p class="f5 fw3 lh-copy mv2">Today my Snow Leopard install was going so slow it felt like I was
trying to swim through molasses. The system was literally so slow that
typing text into some text fields (especially TextMate) lagged at about
a rate of 1 character per second, and opening files (or even running
<code class="highlighter-rouge">touch</code> on them) took a couple of seconds.

After a few fruitless restarts and a keen eye on my logs I started
noticing these errors in Console.app:

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>9/07/09 3:01:37 PM com.apple.launchd[1] (com.apple.dynamic*pager) Exited
with exit code: 1\
9/07/09 3:01:37 PM com.apple.launchd Throttling respawn: Will start in
10 seconds\
9/07/09 3:01:47 PM com.apple.dynamic*pager[2481] dynamic*pager: cannot
open swap directory /private/var/vm\
9/07/09 3:01:47 PM com.apple.launchd Exited with exit code: 1\
9/07/09 3:01:47 PM com.apple.launchd Throttling respawn: Will start in
10 seconds\
9/07/09 3:01:57 PM com.apple.dynamic*pager[2546] dynamic*pager: cannot
open swap directory /private/var/vm\
9/07/09 3:01:57 PM com.apple.launchd Exited with exit code: 1\
9/07/09 3:01:57 PM com.apple.launchd Throttling respawn: Will start in
10 seconds\
9/07/09 3:02:07 PM com.apple.dynamic*pager[2547] dynamic\_pager: cannot
open swap directory /private/var/vm\
9/07/09 3:02:07 PM com.apple.launchd[1] (com.apple.dynamic\_pager[2547])
Exited with exit code: 1\
9/07/09 3:02:07 PM com.apple.launchd[1] (com.apple.dynamic\_pager)
Throttling respawn: Will start in 10 seconds\
</code></pre></div></div>

I don’t know how or why they started but I was able to fix it by simply
running <code class="highlighter-rouge">sudo mkdir /private/var/vm</code> in Terminal. Within a few seconds
of creating the directory, the errors ceased and I could see a swapfile
created inside the directory.

I have no idea what caused the directory to be deleted in the first
place or why OS X isn’t smart enough to try creating it, but the fix is
simple and instantly effective.

Note: I am not sure if this is a Snow Leopard specific issue or not, but
it very well might be. Also, these started right after installing Adobe
CS4, so I feel pretty confident blaming that for now.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>9 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/using-accepts-nested-attributes-for-when-the-child-object-validates-presence-of-parent/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Using accepts_nested_attributes_for When the Child Object validates_presence_of Parent</h3>
      <p class="f5 fw3 lh-copy mv2">I came across an interesting dilemma today in Rails 2.3 whilst trying to
use <code class="highlighter-rouge">accepts_nested_attributes_for</code>.

The models I have were:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Organization</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:users</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:users</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:organization</span>
  <span class="n">validates_presence_of</span> <span class="ss">:organization</span>
<span class="k">end</span>
</code></pre></div></div>

I had an “Organization” creation form which allowed an administrator to
create an Organization and an initial user for it. However, even though
I had filled in all the required fields to pass the validations I was
constantly getting the following error: <code class="highlighter-rouge">Organization can not be blank</code>.

Digging deeper I found that when an object is added to an association
via the <code class="highlighter-rouge">association.build</code> method, the parent object
isn’t actually set:

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">&gt;&gt; o = Organization.new(:name =&gt; "Test")
</span><span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Organization</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Test"</span><span class="kt">&gt;</span>
<span class="o">&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="nf">users</span><span class="p">.</span><span class="nf">build</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"Test User"</span><span class="p">)</span>  
<span class="o">=&gt;</span> <span class="kt">#&lt;</span><span class="no">User</span> <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">organization_id: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Test User"</span><span class="kt">&gt;</span>
<span class="o">&gt;&gt;</span> <span class="n">u</span><span class="p">.</span><span class="nf">organization</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</code></pre></div></div>

Apparently this flaw also applies to
<code class="highlighter-rouge">accepts_nested_attributes_for</code>. When I send through the
User <code class="highlighter-rouge">params</code> through from my form normally with the
<code class="highlighter-rouge">Organization</code> params, it creates the
<code class="highlighter-rouge">User</code> object in the <code class="highlighter-rouge">users</code> association
as you’d expect, but raises a validation error because the
<code class="highlighter-rouge">User</code> instance doesn’t recognise that it is has a parent
<code class="highlighter-rouge">Organization</code>

My quick 5 minute fix was to modify the <code class="highlighter-rouge">Organization</code>
model thusly:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Organization</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:users</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:users</span>

  <span class="k">def</span> <span class="nf">users_attributes_with_self_assignment</span><span class="o">=</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">users_attributes_without_self_assignment</span> <span class="o">=</span> <span class="n">attributes</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">u</span><span class="o">|</span> <span class="n">u</span><span class="p">.</span><span class="nf">organization</span> <span class="o">=</span> <span class="nb">self</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="n">alias_method_chain</span> <span class="ss">:users_attributes</span><span class="o">=</span><span class="p">,</span> <span class="ss">:self_assignment</span>
<span class="k">end</span>
</code></pre></div></div>

Related Rails bugs seem to be
<a href="https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/1943">here</a>
and
<a href="https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/2815">here</a>.
<a href="https://rails.lighthouseapp.com/projects/8994/tickets/1619-patch-support-for-inverse-option-in-associations">This
patch</a>
will also solve the problem and is currently <a href="http://github.com/rails/rails/commit/ccea98389abbf150b886c9f964b1def47f00f237">in
edge</a>,
but didn’t make it in time for Rails 2.3.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>6 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/fish-shell-version-of-git-ps1-function-that-is-bundled-with-git/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Fish Shell version of __git_ps1 Function That is Bundled with Git</h3>
      <p class="f5 fw3 lh-copy mv2">Today at ActionHack, I was showing off Fish Shell to
“`geoffreyd”:http://twitter.com/geoffreyd. I was showing off all the cool fish prompt features I had, but pointed out that my git branch portion needed some beefing up, as it didn’t show the current mode nor commit shas when not in a branch.

Knowing that git came with a `_<em>git</em>ps1 ()@ function for Bash
that achieves this, I decided to port it to Fish tonight. My shell
scripting fu is pretty weak but as far as I can tell it works great and
I am now using it in my shell.

Here is the Fish function (I’ve kept the function name the same as the
bash one):

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>__git_ps1
  <span class="nb">set</span> <span class="nt">-l</span> g <span class="o">(</span>git rev-parse <span class="nt">--git-dir</span> ^/dev/null<span class="o">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">"</span> <span class="o">]</span>
    <span class="nb">set</span> <span class="nt">-l</span> r <span class="s2">""</span>
    <span class="nb">set</span> <span class="nt">-l</span> b <span class="s2">""</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/../.dotest"</span> <span class="o">]</span>
      <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/../.dotest/rebasing"</span> <span class="o">]</span>
        <span class="nb">set </span>r <span class="s2">"|REBASE"</span>
      elseif <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/../.dotest/applying"</span> <span class="o">]</span>
        <span class="nb">set </span>r <span class="s2">"|AM"</span>
      <span class="k">else
        </span><span class="nb">set </span>r <span class="s2">"|AM/REBASE"</span>
      end

      <span class="nb">set </span>b <span class="o">(</span>git symbolic-ref HEAD ^/dev/null<span class="o">)</span>
    elseif <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/.dotest-merge/interactive"</span> <span class="o">]</span>
      <span class="nb">set </span>r <span class="s2">"|REBASE-i"</span>
      <span class="nb">set </span>b <span class="o">(</span><span class="nb">cat</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/.dotest-merge/head-name"</span><span class="o">)</span>
    elseif <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/.dotest-merge"</span> <span class="o">]</span>
      <span class="nb">set </span>r <span class="s2">"|REBASE-m"</span>
      <span class="nb">set </span>b <span class="o">(</span><span class="nb">cat</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/.dotest-merge/head-name"</span><span class="o">)</span>
    elseif <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/MERGE_HEAD"</span> <span class="o">]</span>
      <span class="nb">set </span>r <span class="s2">"|MERGING"</span>
      <span class="nb">set </span>b <span class="o">(</span>git symbolic-ref HEAD ^/dev/null<span class="o">)</span>
    <span class="k">else
      if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/BISECT_LOG"</span> <span class="o">]</span>
        <span class="nb">set </span>r <span class="s2">"|BISECTING"</span>
      end

      <span class="nb">set </span>b <span class="o">(</span>git symbolic-ref HEAD ^/dev/null<span class="o">)</span>
      <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="nv">$b</span> <span class="o">]</span>
        <span class="nb">set </span>b <span class="o">(</span>git describe <span class="nt">--exact-match</span> HEAD ^/dev/null<span class="o">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="nv">$b</span> <span class="o">]</span>
          <span class="nb">set </span>b <span class="o">(</span>cut <span class="nt">-c1-7</span> <span class="s2">"</span><span class="nv">$g</span><span class="s2">/HEAD"</span><span class="o">)</span>
          <span class="nb">set </span>b <span class="s2">"</span><span class="nv">$b</span><span class="s2">..."</span>
        end
      end
    end

    <span class="k">if </span>not <span class="nb">test</span> <span class="nv">$argv</span>
  		<span class="nb">set </span>argv <span class="s2">" (%s)"</span>
  	end

  	<span class="nb">set </span>b <span class="o">(</span><span class="nb">echo</span> <span class="nv">$b</span> | sed <span class="nt">-e</span> <span class="s1">'s|^refs/heads/||'</span><span class="o">)</span>

    <span class="nb">printf</span> <span class="nv">$argv</span> <span class="s2">"</span><span class="nv">$b$r</span><span class="s2">"</span> ^/dev/null
  end
end
</code></pre></div></div>
I have also pushed it to my <code class="highlighter-rouge">dot-files</code> repository
<a href="http://github.com/bjeanes/dot-files/blob/master/fish/functions/__git_ps1.fish">here</a>.

Enjoy :)
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>4 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/using-fields-for-with-nested-attributes-calling-it-multiple-times/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Using fields_for with Nested Attributes, Calling it Multiple Times</h3>
      <p class="f5 fw3 lh-copy mv2">There has been quite an annoying problem that has been bugging
<a href="http://twitter.com/chendo">@chendo</a> and I today.

In short, <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#M001895"><code class="highlighter-rouge">fields_for</code></a> when used with <code class="highlighter-rouge">accepts_nested_attributes_for</code>does not reset it’s index when it’s called multiple times for the same attribute.

Our scenario was the following:

We had a 3 levels of hierarchical data that we had to display in a
<code class="highlighter-rouge">&lt;table&gt;</code>. Because of the nature of the data we were
displaying one level as columns and the other level as rows.
Unfortunately, HTML mandates that we group everything by rows — each
column is really just a single cell. This means that we have to iterate
over the “column” values not just once, but once for every row.

Now, <code class="highlighter-rouge">fields_for</code> takes care of naming your
<code class="highlighter-rouge">&lt;input&gt;</code> tags magically with the correct indexes so that
your models can accept the params directly and magic happens. However,
evidently calling <code class="highlighter-rouge">fields_for</code> multiple times was not
part of the original intention, and it seems resetting the index after
each call was neglected.

`chendo couldn’t see a cleaner way of doing this so we added our own option to reset the index. We didn’t just override the behaviour in case there is a good reason to leave it, but here is our code:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ActionView</span><span class="o">::</span><span class="no">Helpers</span><span class="o">::</span><span class="no">FormBuilder</span>
  <span class="k">def</span> <span class="nf">fields_for_with_nested_attributes_with_index_reset</span><span class="p">(</span><span class="n">association_name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">args</span><span class="p">.</span><span class="nf">last</span><span class="p">[</span><span class="ss">:reset_index</span><span class="p">]</span>
      <span class="vi">@nested_child_index</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="k">end</span>

    <span class="n">fields_for_without_nested_attributes_without_index_reset</span><span class="p">(</span><span class="n">association_name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">alias_method_change</span> <span class="ss">:fields_for_with_nested_attributes</span><span class="p">,</span> <span class="ss">:index_reset</span>
<span class="k">end</span>
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>3 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/using-alterego-with-activerecord/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Using AlterEgo with ActiveRecord</h3>
      <p class="f5 fw3 lh-copy mv2">Today after finding the gem AlterEgo and falling in love with the API,
<a href="http://twitter.com/chendo">@chendo</a> and I came to a sad realisation that its beauty was skin-deep. It seems it is not ActiveRecord-aware and overrides <code class="highlighter-rouge">#state</code> and <code class="highlighter-rouge">#state=</code> on your models. This means that your <code class="highlighter-rouge">state</code> column goes
untouched and your models are always in the default state.

To get around this, @chendo and I hacked together this little monkey patch which does two things:

<ol>
  <li>It adds question methods for each of your defined states. So if you have states: <code class="highlighter-rouge">active</code>, <code class="highlighter-rouge">inactive</code>, and <code class="highlighter-rouge">banned</code>
on your <code class="highlighter-rouge">User</code> model, your instances will have <code class="highlighter-rouge">#active?</code>, <code class="highlighter-rouge">#inactive?</code>, and <code class="highlighter-rouge">#banned?</code></li>
  <li>It properly sets and gets the state of the row and loads it into AlterEgo.</li>
</ol>

Here is the code:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">AlterEgo</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="p">.</span><span class="nf">instance_eval</span> <span class="k">do</span>
      
      <span class="c1"># This will allow us to define a question method for each state in a class</span>
      <span class="c1"># For instance if user has states :active and :inactive, methods active? and inactive?</span>
      <span class="c1"># will be defined when first called</span>
      <span class="k">def</span> <span class="nf">method_missing_with_states</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="k">begin</span>
          <span class="n">method_missing_without_states</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
        <span class="k">rescue</span> <span class="no">NoMethodError</span> <span class="o">=&gt;</span> <span class="n">e</span>
          <span class="n">state_found</span> <span class="o">=</span> <span class="kp">false</span>
          <span class="n">result</span> <span class="o">=</span> <span class="kp">nil</span>
          
          <span class="n">base</span><span class="p">.</span><span class="nf">states</span><span class="p">.</span><span class="nf">keys</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">state</span><span class="o">|</span>
            <span class="k">if</span> <span class="nb">method</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">==</span> <span class="s2">"</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="s2">?"</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">state_found</span>
              <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">send</span> <span class="ss">:define_method</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="s2">?"</span> <span class="k">do</span>
                <span class="nb">self</span><span class="p">.</span><span class="nf">state</span> <span class="o">==</span> <span class="n">state</span>
              <span class="k">end</span>
              <span class="n">state_found</span> <span class="o">=</span> <span class="kp">true</span>
              <span class="n">result</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nf">__send__</span><span class="p">(</span><span class="nb">method</span><span class="p">)</span>
            <span class="k">end</span>
          <span class="k">end</span>
          <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">unless</span> <span class="n">state_found</span>
          <span class="n">result</span>
        <span class="k">end</span>
      <span class="k">end</span>
      <span class="n">alias_method_chain</span> <span class="ss">:method_missing</span><span class="p">,</span> <span class="ss">:states</span>
      
      <span class="c1"># state setter to write to database</span>
      <span class="n">define_method</span> <span class="ss">:state</span><span class="o">=</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
        <span class="n">write_attribute</span><span class="p">(</span><span class="ss">:state</span><span class="p">,</span> <span class="n">value</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># state getter to read from database</span>
      <span class="n">define_method</span> <span class="ss">:state_with_active_record</span> <span class="k">do</span>
        <span class="p">(</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:state</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="nf">state</span> <span class="o">=</span> <span class="n">state_without_active_record</span><span class="p">)).</span><span class="nf">to_sym</span>
      <span class="k">end</span>
      <span class="n">alias_method_chain</span> <span class="ss">:state</span><span class="p">,</span> <span class="ss">:active_record</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>3 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/07/how-to-prepare-your-mac-for-resale/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jul 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">How to Prepare Your Mac for Resale</h3>
      <p class="f5 fw3 lh-copy mv2">First thing is first: you want to re-install Mac OS X (this guide
requires Leopard). Insert your OS X disk and boot off it. Make sure you
do a “Clean Install” so as not to leave any of your files on the system.

When the install is finished, your computer will restart and you’ll see
the traditional OS X welcome screen and the setup assistant. Go through
all the settings, choosing anything just to get the system booted up.
However, make sure you take note of the user account login you use. For
this guide, I will assume login of <code class="highlighter-rouge">temp</code>, and if you don’t have a good
reason not to, you should do the same.

At this point you want to download any Apple updates and install them,
as well as install any bundled software you plan to advertise the
machine coming with. When all your installs are finished and the machine
is as you want it for the customer/recipient, shut down the machine.

Next, turn the machine back on but as soon as you hear the Mac chime
noise, press and hold ⌘S until you are taken to a console (white text on
black screen — looks real nerdy and sci-fi).

The next step is to run all the commands in the code block below

NOTE: If you didn’t use <code class="highlighter-rouge">temp</code> as your username you created in the setup
assistant, make sure you replace <strong>all</strong> instances of <code class="highlighter-rouge">temp</code> with your
actual username.

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Mount the file system so we can modify it</span>
/sbin/fsck <span class="nt">-fy</span>
/sbin/mount <span class="nt">-uw</span> /

<span class="c"># Activate directory services</span>
/bin/launchctl load /System/Library/LaunchDaemons/com.apple.DirectoryServices.plist &amp;

<span class="c"># Delete all traces of the temporary account</span>
/usr/bin/dscl <span class="nb">.</span> <span class="nt">-delete</span> /Users/temp
/usr/bin/dscl <span class="nb">.</span> <span class="nt">-delete</span> /Groups/admin GroupMembership temp
/bin/rm <span class="nt">-rf</span> /Users/temp

<span class="c"># Get rid of a few other files</span>
/bin/rm <span class="nt">-R</span> /Library/Preferences
/bin/rm <span class="nt">-f</span> /root/.bash_history

<span class="c"># Now we make it appear as though the initial setup assistant</span>
<span class="c"># still needs to run</span>
/bin/rm /var/db/.AppleSetupDone

<span class="c"># Reboot and check that it seems like</span>
<span class="c"># it is a new mac, then turn off your computer</span>
<span class="c"># and sell it!</span>
/sbin/reboot
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>1 Jul 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/06/unescaping-utf-8-strings-in-ruby-1-9/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jun 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Unescaping UTF-8 Strings in Ruby 1.9</h3>
      <p class="f5 fw3 lh-copy mv2">Today <a href="http://frozenplague.net">Radar</a> and I encountered a little issue
with <code class="highlighter-rouge">String</code> encodings in Ruby 1.9. In this project, some Merb UTF-8
params needed to be unescaped. We spent some trying to force strings
into UTF-8 encoding but for some reason while the encoding was UTF–8,
the actual contents of the strings were getting massacred.

Long story short:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In Ruby 1.9</span>

<span class="c1"># Broken</span>
<span class="nb">puts</span> <span class="no">URI</span><span class="o">::</span><span class="n">unescape</span><span class="p">(</span><span class="s2">"Baden-W%C3%BCrttemberg"</span><span class="p">)</span> <span class="c1"># =&gt; "Baden-WÃ¼rttemberg"</span>

<span class="c1"># Working</span>
<span class="nb">puts</span> <span class="no">CGI</span><span class="o">::</span><span class="n">unescape</span><span class="p">(</span><span class="s2">"Baden-W%C3%BCrttemberg"</span><span class="p">)</span> <span class="c1"># =&gt; "Baden-Württemberg"</span>
</code></pre></div></div>

Another lesson we learnt on our adventures today is the following:

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m1</span> <span class="o">=</span> <span class="s2">"Munich"</span>
<span class="nb">puts</span> <span class="o">=</span> <span class="n">m1</span><span class="p">.</span><span class="nf">encoding</span>  <span class="c1"># let's suppose it is something other than UTF-8, such as ASCII-8Bit</span>

<span class="n">m2</span> <span class="o">=</span> <span class="s2">"München"</span>
<span class="nb">puts</span> <span class="o">=</span> <span class="n">m2</span><span class="p">.</span><span class="nf">encoding</span>  <span class="c1"># let's suppose we have a UTF-8 encoded string</span>


<span class="c1"># The following will raise an exception about mismatched encodings</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">&lt;&lt;</span> <span class="n">m2</span>

<span class="c1"># The easiest way to get around this is to do the concatenation like so:</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">&lt;&lt;</span> <span class="n">m2</span><span class="p">.</span><span class="nf">force_encoding</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">)</span>
</code></pre></div></div>
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>30 Jun 2009</time>
        
        <span class="ttl">&middot; 



  
	  Less than 1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/06/rubycocoa-and-keychain-access/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jun 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">RubyCocoa and Keychain access</h3>
      <p class="f5 fw3 lh-copy mv2">There have been a few posts asking how to access and manipulate the
Keychain from within RubyCocoa but no answers supplied. As someone who
is just getting into RubyCocoa (and Cocoa all together for that matter),
I thought I’d document once and for all the process I took to get it
working.

I am running on Leopard and while 10.5 is supposed to ship with
BridgeSupport for most frameworks, the Security framework must have been
left out. After playing around with using other frameworks (such as the
AddressBook framework) and seeing how they were used, I did a bit of
digging in the Apple Developer Documentation (incredible resource for
anyone starting out) and stumbled across this gem: <a href="http://developer.apple.com/documentation/Cocoa/Conceptual/RubyPythonCocoa/Articles/GenerateFrameworkMetadata.html#//apple_ref/doc/uid/TP40005426">Generate Framework
Metadata</a>

After reading this, I was accessing the keychain within 5 minutes.
Here’s how:

<ol>
  <li>
    Run the following commands (first one will take some time):

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">gen_bridge_metadata -f Security -o Security.bridgesupport
mkdir -p /Library/BridgeSupport
mv Security.bridgesupport /Library/BridgeSupport
</span></code></pre></div>    </div>
  </li>
  <li>
    Open an IRB session to test it:
  </li>
</ol>

<div class="language-irb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">&gt;&gt; require 'osx/cocoa'
</span><span class="p">=&gt;</span> <span class="kp">true</span>
<span class="o">&gt;&gt;</span> <span class="no">OSX</span><span class="p">.</span><span class="nf">require_framework</span> <span class="s1">'Security'</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">&gt;&gt;</span> <span class="n">defined?</span> <span class="no">OSX</span><span class="o">::</span><span class="no">SecKeychainAddGenericPassword</span><span class="p">()</span>
<span class="o">=&gt;</span> <span class="s2">"method"</span>
</code></pre></div></div>
Hoorah! Two steps! Well, one because the second one was just testing…
Now go make password-able RubyCocoa application! I am not sure how to
pull this off with deployable apps but I suggest your apps could ship
with the file or run those commands on first-run or if the
Security.bridgesupport file doesn’t exist. Note: I have not tested
either of those scenarios, but I would guess the latter would be more
reliable for cross-version development (i.e. Tiger + Leopard)

<h3 id="how-to-use-these-methods">How to use these methods</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Require needed libraries</span>

<span class="nb">require</span> <span class="s1">'osx/cocoa'</span>
<span class="kp">include</span> <span class="no">OSX</span>
<span class="n">require_framework</span> <span class="s1">'Security'</span>

<span class="c1"># Set up some relevant variables</span>

<span class="n">service</span> <span class="o">=</span> <span class="s2">"Test Service"</span>
<span class="n">account</span> <span class="o">=</span> <span class="s2">"MyUsername"</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">"MyPassword"</span>

<span class="c1"># Add password to default keychain (first param)</span>

<span class="no">SecKeychainAddGenericPassword</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="n">service</span><span class="p">.</span><span class="nf">length</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="nf">length</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">password</span><span class="p">.</span><span class="nf">length</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>

<span class="c1"># Finding a password in default keychain (first param)</span>

<span class="n">status</span><span class="p">,</span> <span class="o">*</span><span class="n">password</span> <span class="o">=</span> <span class="no">SecKeychainFindGenericPassword</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="n">service</span><span class="p">.</span><span class="nf">length</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="nf">length</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>

<span class="c1"># Password-related data</span>
<span class="n">password_length</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="nf">shift</span> <span class="c1"># =&gt; 10</span>
<span class="n">password_data</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="nf">shift</span> <span class="c1"># OSX::ObjcPtr object</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">password_data</span><span class="p">.</span><span class="nf">bytestr</span><span class="p">(</span><span class="n">password_length</span><span class="p">)</span>

<span class="c1"># The last item is another OSX::ObjcPtr. I haven't figured </span>
<span class="c1"># out how to cast or use this yet but will post when I've</span>
<span class="c1"># figured it out</span>
<span class="n">keychain_item</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="nf">shift</span>

<span class="c1"># Yay it works! You can also check the password exists</span>
<span class="c1"># in the Keychain Access utility. I've confirmed that</span>
<span class="c1"># this works</span>
<span class="nb">puts</span> <span class="n">password</span> <span class="c1"># =&gt; "MyPassword"</span>
</code></pre></div></div>

<h3 id="update-4808-below-is-a-fix-for-the-rexml-bug-some-people-have">[UPDATE 4/8/08]: Below is a fix for the REXML bug some people have</h3>
been getting (myself included)

There is good news for anyone that has been getting the following error:

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>undefined local variable or method `trans’ for &lt;UNDEFINED&gt; … &lt;/&gt;:REXML::Document
Usage: gen_bridge_metadata [options] &lt;headers…&gt;
Use the `-h’ flag or consult gen_bridge_metadata(1) for help.
</code></pre></div></div>

There is a very simple fix. This is caused by a typo in the source of
REXML. It’s such a massive bug I can’t believe it made it into the
release of Ruby but i did some poking around and it looks like they
renamed a method and didn’t change all references to it.

There are two ways to fix it—patching REXML; and patching <code class="highlighter-rouge">gen_bridge_metadata</code>.

Personally I prefer patching the generator for peace of mind and have submitted the patch at
<a href="http://bridgesupport.macosforge.org/trac/ticket/1">http://bridgesupport.macosforge.org/trac/ticket/1</a>,
but I’ll show both fixes.

<h4 id="patching-genbridgemetadata">Patching gen<em>bridge</em>metadata</h4>

<ol>
  <li>Open <code class="highlighter-rouge">/usr/bin/gen_bridge_metadata and find the method definition for
</code>generate_xml`</li>
  <li>Replace <code class="highlighter-rouge">0</code> in the <code class="highlighter-rouge">xml_document.write()</code> with <code class="highlighter-rouge">-1</code> (both occurrences)</li>
  <li>Save!</li>
</ol>

<h4 id="patching-rexml">Patching REXML</h4>

<ol>
  <li>Open
<code class="highlighter-rouge">/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/ruby/1.8/rexml/document.rb</code></li>
  <li>Find the line that has <code class="highlighter-rouge">if trans</code> and change it to <code class="highlighter-rouge">if transitive</code></li>
  <li>Save!</li>
</ol>

</p>

      <div class="f6 fw3 silver mt0">
        
        <time>29 Jun 2009</time>
        
        <span class="ttl">&middot; 



  
	  2 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/06/generating-sound-from-sine-waves-on-the-iphone/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jun 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Generating Sound from Sine Waves on the iPhone</h3>
      <p class="f5 fw3 lh-copy mv2">A few months ago I saw this extremely addictive flash game/toy called
<a href="http://lab.andre-michelle.com/tonematrix">ToneMatrix</a>.

My immediate thought was: “This would make quite possibly the coolest iPhone application ever.”

So my good friend, <a href="http://twitter.com/sync1983">Anthony Mittaz</a>, and I
decided to have a crack at it but hit one immediate hurdle; however
proficient an iPhone developer Anthony is, he hadn’t done anything to do
with sound, and nor had I, in <em>any</em> language/framework, let alone on the
iPhone. Let me tell you this: Apple’s documentation in this area is
severely lacking. Tangent: well, almost all Apple documentation on
specialised things is pretty sparse.

I think we spent about two weeks’ worth of nights reading documentation,
source code (Cocoa, iPhone, Java, C, and others), and plain outright
stabbing in the dark code-wise getting not much more than ugly pops and
crackles. Whenever we thought we had a clean note working, we’d change
the frequency to what <strong>should</strong> be another nice clean note, and would
instead get ear-shattering screeches.

Nonetheless we persevered and were even able to come up with a nifty
little piece of code that could take an array of frequencies and play
them together in what could be made to sound like a pleasant chord.

Here is the relevant code:

<h2 id="code">Code</h2>

<strong>TonePlayer.h</strong>

<pre><code class="language-objective-c">#import &lt;Foundation/Foundation.h&gt;
#include &lt;AudioUnit/AudioUnit.h&gt;
#include &lt;math.h&gt;

#define kTonesAvailable 16
#define kOutputBus 0
#define kInputBus 1
#define kNumChannels 2

@interface TonePlayer : NSObject {
  AudioComponentInstance audioUnit;
  AudioStreamBasicDescription audioFormat;
  float phase[kTonesAvailable];
  float frequencies[kTonesAvailable];
}

-(OSStatus)start;
-(OSStatus)stop;
-(void)resetFrequencies;
-(void)cleanUp;
-(void)intialiseAudio;
@end

// Some C function headers to get arount compile errors while I refactor to be more readable
float phaseOffsetFromFrequency(float);
OSStatus RenderCallback(void*, AudioUnitRenderActionFlags*, const AudioTimeStamp*, UInt32, UInt32, AudioBufferList*);
</code></pre>

<strong>TonePlayer.m</strong>

<pre><code class="language-objective-c">#import "TonePlayer.h"

typedef struct {
  @defs(TonePlayer);
} SinewaveDef;

@implementation TonePlayer

static float gSampleRate = 44100.;
static float notes[111]  = {
      8.1758, 8.6620, 9.1770, 9.7227, 10.3009, 10.9134, 11.5623, 12.2499, 
      12.9783, 13.7500, 14.5676, 15.4339, 16.3516, 17.3239, 18.3540, 19.4454,
      20.6017, 21.8268, 23.1247, 24.4997, 25.9565, 27.5000, 29.1352, 30.8677, 
      32.7032, 34.6478, 36.7081, 38.8909, 41.2034, 43.6535, 46.2493, 48.9994, 
      51.9131, 55.0000, 58.2705, 61.7354, 65.4064, 69.2957, 73.4162, 77.7817, 
      82.4069, 87.3071, 92.4986, 97.9989, 103.8262, 110.0000, 116.5409, 123.4708,
      130.8128, 138.5913, 146.8324, 155.5635, 164.8138, 174.6141, 184.9972, 
      195.9977, 207.6523, 220.0000, 233.0819, 246.9417, 261.6256, 277.1826, 
      293.6648, 311.1270, 329.6276, 349.2282, 369.9944, 391.9954, 415.3047, 
      440.0000, 466.1638, 493.8833, 523.2511, 554.3653, 587.3295, 622.2540, 
      659.2551, 698.4565, 739.9888, 783.9909, 830.6094, 880.0000, 932.3275, 
      987.7666, 1046.5023, 1108.7305, 1174.6591, 1244.5079, 1318.5102, 1396.9129, 
      1479.9777, 1567.9817, 1661.2188, 1760.0000, 1864.6550, 1975.5332, 2093.0045, 
      2217.4610, 2349.3181, 2489.0159, 2637.0205, 2793.8259, 2959.9554, 3135.9635, 
      3322.4376, 3520.0000, 3729.3101, 3951.0664, 4186.0090, 4434.9221, 4698.6363
  };

OSStatus    RenderCallback(void                          *inRefCon,
                           AudioUnitRenderActionFlags    *ioActionFlags,
                           const AudioTimeStamp          *inTimeStamp,
                           UInt32                        inBusNumber,
                           UInt32                        inNumberFrames,
                           AudioBufferList               *ioData)
{
  SinewaveDef* def = inRefCon;
  
  float *outL = ioData-&gt;mBuffers[0].mData;
  float *outR = ioData-&gt;mBuffers[1].mData;

  float wave, j;
  float freqs[kTonesAvailable];
  
  memset(freqs, 0.0f, sizeof(freqs));
  
  for (int i=0; i&lt; inNumberFrames; i++){
    wave = 0.0f;
    j = 0.0f;
    
    for(int m = 0; m &lt; kTonesAvailable; ++m) {
      if(def-&gt;frequencies[m] != 0) {
        if(freqs[m] == 0) freqs[m] = phaseOffsetFromFrequency(def-&gt;frequencies[m]);

        wave += 0.5 * sinf(def-&gt;phase[m]);
        def-&gt;phase[m] += freqs[m];
        
        ++j;
      }
    }
    
    wave /= j;
    
    *outL++ = wave;
    *outR++ = wave;
  }

  return noErr;
}

float phaseOffsetFromFrequency(float frequency) {
  return (float)(frequency * 2.0 * M_PI / gSampleRate);
}

-(void)resetFrequencies{
  memset(frequencies, 0.0f, sizeof(frequencies));
  memset(phase, 0.0f, sizeof(phase));
}

-(OSStatus)start{
  [self resetFrequencies];
  OSStatus status = AudioOutputUnitStart(audioUnit);
  
  // See http://www.phys.unsw.edu.au/jw/notes.html for note numbers
  frequencies[0] = notes[60]; // C
  frequencies[1] = notes[64]; // E
  frequencies[2] = notes[67]; // G
  
  sleep(1);
  
  frequencies[0] = notes[64];
  frequencies[1] = notes[67];
  frequencies[2] = notes[71];
  
  sleep(1);
  
  frequencies[0] = notes[74];
  frequencies[1] = notes[67];
  frequencies[2] = notes[70];
  
  
  return status;
}

-(OSStatus)stop{
  return AudioOutputUnitStop(audioUnit);
}

-(void)cleanUp{
  AudioUnitUninitialize(audioUnit);
}

-(AudioStreamBasicDescription)audioFormat{
  return audioFormat;
}

// Below code is a cut down version (for output only) of the code written by
// Micheal "Code Fighter" Tyson (punch on Mike)
// See http://michael.tyson.id.au/2008/11/04/using-remoteio-audio-unit/ for details
-(void)intialiseAudio{
  OSStatus status;
  
  // Describe audio component
  AudioComponentDescription desc;
  desc.componentType = kAudioUnitType_Output;
  desc.componentSubType = kAudioUnitSubType_RemoteIO;
  desc.componentFlags = 0;
  desc.componentFlagsMask = 0;
  desc.componentManufacturer = kAudioUnitManufacturer_Apple;
  
  // Get component
  AudioComponent inputComponent = AudioComponentFindNext(NULL, &amp;desc);
  
  // Get audio units
  status = AudioComponentInstanceNew(inputComponent, &amp;audioUnit);
  
  UInt32 flag = 1;
  // Enable IO for playback
  status = AudioUnitSetProperty(audioUnit, 
                  kAudioOutputUnitProperty_EnableIO, 
                  kAudioUnitScope_Output, 
                  kOutputBus,
                  &amp;flag, 
                  sizeof(flag));

  // Describe format
        audioFormat.mSampleRate = gSampleRate;
  audioFormat.mFormatID = kAudioFormatLinearPCM;
  audioFormat.mFormatFlags = kAudioFormatFlagsNativeFloatPacked | kAudioFormatFlagIsNonInterleaved;
  audioFormat.mFramesPerPacket = 1;
  audioFormat.mBytesPerPacket = sizeof(Float32);
  audioFormat.mBytesPerFrame = sizeof(Float32);
  audioFormat.mChannelsPerFrame = kNumChannels;
  audioFormat.mBitsPerChannel = 32;
  
  //Apply format
  status = AudioUnitSetProperty(audioUnit, 
                  kAudioUnitProperty_StreamFormat, 
                  kAudioUnitScope_Input, 
                  kOutputBus, 
                  &amp;audioFormat, 
                  sizeof(audioFormat));
   
  // Set up the playback  callback
  AURenderCallbackStruct callbackStruct;
  callbackStruct.inputProc = RenderCallback;
  //set the reference to "self" this becomes *inRefCon in the playback callback
  callbackStruct.inputProcRefCon = self;
  
  status = AudioUnitSetProperty(audioUnit, 
                  kAudioUnitProperty_SetRenderCallback, 
                  kAudioUnitScope_Global, 
                  kOutputBus,
                  &amp;callbackStruct, 
                  sizeof(callbackStruct));
  
  // Initialise
  status = AudioUnitInitialize(audioUnit);
}

@end
</code></pre>

I really wish that I could remember how most of it worked, or, more
importantly, the multitude of projects whose code we had to look at to
get it working. If you recognise any of the code or can help add
references on how people can build up a nice list of references for
people to use if are following a similar pursuit.

If you are wondering what ever happened to the application we were
building, it seems we weren’t the only ones who recognised the potential
of ToneMatrix as an iPhone application. During the 2-3 weeks of us
developing the sound generation code, about 5-6 ToneMatrix clones were
added to the AppStore. While most were crap, there was one that we felt
left little to be improved upon and we therefore recommend everyone goes
and downloads
<a href="http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=313573137&amp;mt=8">Melodica</a>.
It’s just as addictive as the Flash version, only portable!
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>29 Jun 2009</time>
        
        <span class="ttl">&middot; 



  
	  4 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/06/colemak/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jun 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Colemak</h3>
      <p class="f5 fw3 lh-copy mv2">About a year ago I found out about the <a href="http://colemak.com">Colemak</a>
keyboard layout. This is what it looks like:

<img src="http://colemak.com/wiki/images/8/80/Colemak_layout_2.png" alt="image" />

I was instantly intrigued and was drawn to a few key features:

<ul>
  <li>Easy to learn</li>
  <li>Caps lock is replaced with backspace (making backspace closer to
fingers and getting rid of the useless caps lock)</li>
  <li>Obvious health benefits (just look how much your fingers need to
move when using QWERTY <a href="http://colemak.com/Compare">here</a>)</li>
  <li>It’s not QWERTY, which was designed <a href="http://colemak.com/FAQ#What.27s_wrong_with_the_QWERTY_layout.3F">without any consideration to
ergonomic or efficiency
aspects</a>.</li>
</ul>

Long story short: it took me a few tries to commit to learning it (3
tries over year in fact). Eventually I went cold turkey for a week and
haven’t looked back. Typing is more comfortable and faster already.

Getting Colemak on OS X is as simple as following <a href="http://colemak.com/Mac">the simple
Installation instructions</a>. The instructions
seem out of date when it comes to re-mapping caps lock to backspace. It
is as simple as downloading
<a href="http://www.pqrs.org/tekezo/macosx/keyremap4macbook/extra.html">PCKeyboardHack</a>,
installing it, rebooting, and choosing the option in its preference pane
to remap caps lock to delete (key code 51).

<h3 id="snow-leopard">Snow Leopard</h3>

Colemak itself works fine under Snow Leopard, however the PCKeyboardHack
utility does not work, because it is hardcoded to only load the kernel
driver if it recognises the OS version. Luckily it is open source, and I
was able to import the Mercurial project into a
<a href="http://github.com">GitHub</a>
<a href="http://github.com/bjeanes/PCKeyboardHack">project</a>, modify it, and
build a version that works fine on Snow Leopard.

<h3 id="dead-keys-that-apple-uses-on-the-qwerty-layout">Dead Keys that Apple uses on the QWERTY layout</h3>

One thing I loved about the QWERTY layout on OS X was the sensible dead
key and alternate character behaviours, allowing users to quickly and
logically input characters such as: , é, ¡, ¿, », ‡, °, etc. The
version of Colemak, for one reason or another, moved or simply didn’t
have many of these shortcuts.

So, I created my own Colemak layout bundle that moves the dead key
positions to preserve the associations with the character position
changes from QWERTY to Colemak. This means, for example,  can be
created by pressing ⌥⇧K on either keyboard layout (where K is the key
that outputs K, not the key that physically says K on it).

My version of the Colemak bundle is available on <a href="http://github.com/bjeanes/colemak">my
GitHub</a> and a direct download to a
zip file is available
<a href="http://cloud.github.com/downloads/bjeanes/colemak/ColemakKeyboardLayouts.bundle.zip">here</a>.
Simply put the .bundle file in your <code class="highlighter-rouge">~/Library/Keyboard Layouts</code>
directory. The bundle includes both the original keyboard layout and my
re-created one so you can switch between them if you need both, for any
reason.
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>29 Jun 2009</time>
        
        <span class="ttl">&middot; 



  
	  2 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/06/snow-leopard-for-the-ruby-developer/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jun 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Snow Leopard for the Ruby Developer</h3>
      <p class="f5 fw3 lh-copy mv2">After the 2009 WWDC release, I decided to give Snow Leopard a try on my
production machine. Crossing my fingers, expecting a plethora of broken
gems and databases, I wiped my hard drive clean and installed the latest
build.

Much to my surprise, most things worked flawlessly and exactly as it did
on Leopard.

<h3 id="what-ships-with-snow-leopard">What Ships with Snow Leopard</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> gem <span class="nt">--version</span>
<span class="go">1.3.1

</span><span class="gp">$</span> ruby <span class="nt">--version</span>
<span class="go">ruby 1.8.7 (2008-08-11 patchlevel 72) [universal-darwin10.0]

</span><span class="gp">$</span> gem list
<span class="go">
*** LOCAL GEMS ***
 
actionmailer (2.2.2, 1.3.6)
actionpack (2.2.2, 1.13.6)
actionwebservice (1.2.6)
activerecord (2.2.2, 1.15.6)
activeresource (2.2.2)
activesupport (2.2.2, 1.4.4)
acts_as_ferret (0.4.3)
capistrano (2.5.2)
cgi_multipart_eof_fix (2.5.0)
daemons (1.0.10)
dnssd (0.6.0)
fastthread (1.0.1)
fcgi (0.8.7)
ferret (0.11.6)
gem_plugin (0.2.3)
highline (1.5.0)
hpricot (0.6.164)
libxml-ruby (1.1.2)
mongrel (1.1.5)
needle (1.3.0)
net-scp (1.0.1)
net-sftp (2.0.1, 1.1.1)
net-ssh (2.0.4, 1.1.4)
net-ssh-gateway (1.0.0)
rails (2.2.2, 1.2.6)
rake (0.8.3)
RedCloth (4.1.1)
ruby-openid (2.1.2)
ruby-yadis (0.3.4)
rubynode (0.1.5)
sqlite3-ruby (1.2.4)
termios (0.9.4)
xmpp4r (0.4)
</span></code></pre></div></div>

Quite possibly these default gems and versions will change between now
and the final release of Snow Leopard. For instance, this seed comes
with Rails 2.2.2, even though we are already at 2.3.2. Snow Leopard
doesn’t come out till September and by then we could have an even newer
version of Rails that might be bundled.

<h3 id="what-doesnt-work-and-how-to-fix-it">What doesn’t work, and how to fix it.</h3>

<strong>Textmate</strong> - Everything works fine except for the following shortcuts:
⌘←, ⌘→, ⌘⇧←, and ⌘⇧→. These shortcuts are for moving the text insertion
point to beginning and end of line, and selecting to beginning and end
of line, respectively. The fix is easy, simply download and double click
the TextMate macros attached to <a href="http://ticket.macromates.com/show?ticket_id=0FDE7076">this
ticket</a>

<strong>Nokogiri</strong> - Nokogiri installs fine but gives error “native.bundle:
mach-o, but wrong architecture” when used. Getting around this is as
easy as running
<code class="highlighter-rouge">sudo gem install nokogiri -s http://tenderlovemaking.com/</code> to get the
latest development release which includes a fix for this.

<strong>do_sqlite3</strong> - I haven’t personally used this or tried to fix it but
I saw report of it not working <a href="http://twitter.com/benlovell/status/2182275909">by
@benlovell</a>

<strong>Passenger PrefPane</strong> - Preference pane does not load. No known fix
(it’s probably an easy fix but I haven’t looked enough into it to try).
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>28 Jun 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
  <a class="link black-80 hover-silver" href="/2009/06/ghost-manage-hostnames-effortlessly/">
    <article class="f5 lh-copy fw3 pb4 bb b--light-gray">
      <div class="f6 fw6 lh-title ttu tracked mv4"><time>Jun 2009</time></div>
      <h3 class="f3 fw6 lh-title mb0">Ghost - Manage hostnames effortlessly</h3>
      <p class="f5 fw3 lh-copy mv2"><h3 id="background">Background</h3>

Ghost is a gem that provides a command and a Ruby API for managing
hostnames locally, much as people do manually by editing <code class="highlighter-rouge">/etc/hosts</code>
now.

Sometime last year I was having to add lots of
<a href="http://modrails.com/">Passenger</a> virtual hosts on my development
machine and felt that having to constantly edit the <code class="highlighter-rouge">/etc/hosts</code> file
was a bit archaic for my liking and that there must be a nicer way of
accomplishing the same task.

Having seen the <a href="http://www.fngtps.com/2008/09/passenger-preference-pane-v1-1">Passenger Preference
Pane</a>
added hostnames without requiring the user to do anything special, I had
a peak into its <a href="http://github.com/alloy/passengerpane">source</a> and
discovered the <code class="highlighter-rouge">dscl</code> (<a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/dscl.1.html">man
page</a>)
command that comes with Leopard.

For the hell of it I decided to write my
<a href="http://github.com/bjeanes/ghost">Ghost</a> gem using this command and use
it to make a nice wrapper that has an easier syntax than <code class="highlighter-rouge">dscl</code>, and
that is less effort than manually editing my hosts file. Happy with the
result, a few other people requested support for other unix systems and
<a href="http://newtonsinlaws.com">Mitchell V Riley</a> was kind enough to patch
Ghost to fall back to processing and editing the <code class="highlighter-rouge">/etc/hosts</code> file when
not on Leopard.

<h3 id="usage">Usage</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> ghost add mydevsite.local
<span class="gp">  [Adding] mydevsite.local -&gt;</span> 127.0.0.1
<span class="go">
</span><span class="gp">$</span> ghost add staging-server.local 67.207.136.164
<span class="gp">  [Adding] staging-server.local -&gt;</span> 67.207.136.164
<span class="go">
</span><span class="gp">$</span> ghost list
<span class="go">Listing 2 host(s):
</span><span class="gp">  mydevsite.local      -&gt;</span> 127.0.0.1
<span class="gp">  staging-server.local -&gt;</span> 67.207.136.164
<span class="go">
</span><span class="gp">$</span> ghost delete mydevsite.local
<span class="go">  [Deleting] mydevsite.local

</span><span class="gp">$</span> ghost list
<span class="go">Listing 1 host(s):
</span><span class="gp">  staging-server.local -&gt;</span> 67.207.136.164
<span class="go">
</span><span class="gp">$</span> ghost modify staging-server.local 64.233.167.99
<span class="gp">  [Modifying] staging-server.local -&gt;</span> 64.233.167.99
<span class="go">
</span><span class="gp">$</span> ghost list
<span class="go">Listing 1 host(s):
</span><span class="gp">  staging-server.local -&gt;</span> 64.233.167.99
<span class="go">
</span><span class="gp">$</span> ghost empty
<span class="go">  [Emptying] Done.

</span><span class="gp">$</span> ghost list
<span class="go">Listing 0 host(s):
</span></code></pre></div></div>

<h3 id="other">Other</h3>

Since creating Ghost I’ve used the Ruby library to add an initializer to
my Rails projects that add the domain locally if running under Passenger
in development mode (some configuration is needed to let it do this as
it needs sudo).

Also, I have heard reports that entries in the <code class="highlighter-rouge">/etc/hosts</code> file are
ignored in Snow Leopard. I haven’t tried because I only ever use Ghost
now, but I do know that Ghost still works well.

<h3 id="caveats">Caveats</h3>

It only works on Unix-based systems and the <code class="highlighter-rouge">/etc/hosts</code> path is
hard-coded. Windows support is entirely possible if somebody wants to
use it. It isn’t something I am likely to do as I haven’t booted Windows
in at least a year. In fact, I don’t think I have even ever installed
Ruby on Windows before…
</p>

      <div class="f6 fw3 silver mt0">
        
        <time>28 Jun 2009</time>
        
        <span class="ttl">&middot; 



  
	  1 min read
	

</span>
      </div>
    </article>
  </a>
  
</section>



<footer class="flex justify-start items-baseline mw7 center w-100 ph3 ph4-ns mt4 mb2 lh-copy">
  <nav class="flex flex-row flex-wrap">
    <span class="f7 fw3 silver mr3 ttc"><a href="https://bjeanes.com/" class="f7 fw5 silver hover-silver link underline-hover" title="Bo Jeanes">Bo jeanes</a> &copy; 2020</span>
    

    
    <span class="f7 fw3 silver mr3">Designed with <a href="https://desiredpersona.com/themes/" class="f7 fw3 silver hover-silver link underline-hover mr3" target="_blank">Minimal Theme</a></span>
    
  </nav>
</footer>



</body>
</html>
